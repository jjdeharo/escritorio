import{u as w,r as p,j as e,b as y}from"./index-BK-Cnbmr.js";import{H as N}from"./index-BK-Cnbmr.js";import{R as C}from"./rotate-ccw-CVZTriUL.js";const I=()=>{const{t:n}=w(),[t,o]=p.useState([]),[c,m]=p.useState([]),[g,h]=p.useState(0),f=s=>{const i=[];Array.from(s).forEach(r=>{r.type.startsWith("image/")&&i.push(new Promise(d=>{const a=new FileReader;a.onload=l=>d(l.target?.result),a.readAsDataURL(r)}))}),Promise.all(i).then(r=>{const d=[];r.forEach((a,l)=>{d.push({id:l*2,pairId:l,content:a,isFlipped:!1,isMatched:!1}),d.push({id:l*2+1,pairId:l,content:a,isFlipped:!1,isMatched:!1})}),o(d.sort(()=>Math.random()-.5)),h(0),m([])})},u=s=>{s.target.files&&s.target.files.length>1?f(s.target.files):alert(n("widgets.memory_game.min_images_alert"))},j=s=>{if(t[s].isFlipped||c.length===2)return;const i=[...c,s];m(i);const r=[...t];r[s].isFlipped=!0,o(r)};p.useEffect(()=>{if(c.length===2){h(g+1);const[s,i]=c,r=t[s],d=t[i];if(r.pairId===d.pairId){const a=t.map(l=>l.pairId===r.pairId?{...l,isMatched:!0}:l);o(a),m([])}else setTimeout(()=>{const a=[...t];a[s].isFlipped=!1,a[i].isFlipped=!1,o(a),m([])},1e3)}},[c]);const x=t.length>0&&t.every(s=>s.isMatched);return t.length===0?e.jsxs("div",{className:"memory-placeholder",children:[e.jsx(y,{size:48}),e.jsx("p",{children:n("widgets.memory_game.upload_prompt")}),e.jsx("small",{children:n("widgets.memory_game.upload_rule")}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:u})]}):e.jsxs("div",{className:"memory-game-widget",children:[e.jsx("div",{className:"game-board",style:{gridTemplateColumns:`repeat(${Math.ceil(Math.sqrt(t.length))}, 1fr)`},children:t.map((s,i)=>e.jsx("div",{className:`card ${s.isFlipped||s.isMatched?"flipped":""}`,onClick:()=>j(i),children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-front",children:"?"}),e.jsx("div",{className:"card-back",children:e.jsx("img",{src:s.content,alt:`par ${s.pairId}`})})]})},i))}),e.jsxs("div",{className:"game-footer",children:[e.jsx("span",{children:n("widgets.memory_game.moves",{count:g})}),e.jsxs("button",{onClick:()=>o([]),children:[e.jsx(C,{size:16})," ",n("widgets.memory_game.start_over")]})]}),x&&e.jsxs("div",{className:"game-won-overlay",children:[e.jsx("h2",{children:n("widgets.memory_game.win_title")}),e.jsx("p",{children:n("widgets.memory_game.win_message",{moves:g})}),e.jsx("button",{onClick:()=>o([]),children:n("widgets.memory_game.play_again")})]})]})};export{I as MemoryGameWidget,N as widgetConfig};
