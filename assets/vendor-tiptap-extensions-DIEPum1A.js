import{E as u,r as y,s as w,u as S,i as P}from"./vendor-tiptap-core-CKFakkLY.js";import{a as h,P as p}from"./vendor-prosemirror-state-NYKsNaF9.js";import{d as v}from"./vendor-prosemirror-dropcursor-C0L_H6JX.js";import{D as m,a as g}from"./vendor-prosemirror-view-BAC1zYEb.js";import{g as z}from"./vendor-prosemirror-gapcursor-BdM-MfDS.js";import{h as E,r as N,u as O}from"./vendor-prosemirror-history-DQINzrbf.js";u.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=e=>{const t=e?.node||this.editor.state.doc;if((e?.mode||this.options.mode)==="textSize"){const s=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(s)}return t.nodeSize},this.storage.words=e=>{const t=e?.node||this.editor.state.doc,o=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(o)}},addProseMirrorPlugins(){let e=!1;return[new p({key:new h("characterCount"),appendTransaction:(t,o,s)=>{if(e)return;const r=this.options.limit;if(r==null||r===0){e=!0;return}const n=this.storage.characters({node:s.doc});if(n>r){const c=n-r,i=0,a=c;console.warn(`[CharacterCount] Initial content exceeded limit of ${r} characters. Content was automatically trimmed.`);const d=s.tr.deleteRange(i,a);return e=!0,d}e=!0},filterTransaction:(t,o)=>{const s=this.options.limit;if(!t.docChanged||s===0||s===null||s===void 0)return!0;const r=this.storage.characters({node:o.doc}),n=this.storage.characters({node:t.doc});if(n<=s||r>s&&n>s&&n<=r)return!0;if(r>s&&n>s&&n>r||!t.getMeta("paste"))return!1;const i=t.selection.$head.pos,a=n-s,d=i-a,l=i;return t.deleteRange(d,l),!(this.storage.characters({node:t.doc})>s)}})]}});var k=u.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[v(this.options)]}});u.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new p({key:new h("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:o,isFocused:s}=this.editor,{anchor:r}=t,n=[];if(!o||!s)return m.create(e,[]);let c=0;this.options.mode==="deepest"&&e.descendants((a,d)=>{if(a.isText)return;if(!(r>=d&&r<=d+a.nodeSize-1))return!1;c+=1});let i=0;return e.descendants((a,d)=>{if(a.isText||!(r>=d&&r<=d+a.nodeSize-1))return!1;if(i+=1,this.options.mode==="deepest"&&c-i>0||this.options.mode==="shallowest"&&i>1)return this.options.mode==="deepest";n.push(g.node(d,d+a.nodeSize,{class:this.options.className}))}),m.create(e,n)}}})]}});var F=u.create({name:"gapCursor",addProseMirrorPlugins(){return[z()]},extendNodeSchema(e){var t;const o={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=y(w(e,"allowGapCursor",o)))!=null?t:null}}});u.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new p({key:new h("placeholder"),props:{decorations:({doc:e,selection:t})=>{const o=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=t,r=[];if(!o)return null;const n=this.editor.isEmpty;return e.descendants((c,i)=>{const a=s>=i&&s<=i+c.nodeSize,d=!c.isLeaf&&S(c);if((a||!this.options.showOnlyCurrent)&&d){const l=[this.options.emptyNodeClass];n&&l.push(this.options.emptyEditorClass);const f=g.node(i,i+c.nodeSize,{class:l.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:c,pos:i,hasAnchor:a}):this.options.placeholder});r.push(f)}return this.options.includeChildren}),m.create(e,r)}}})]}});u.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new p({key:new h("selection"),props:{decorations(o){return o.selection.empty||e.isFocused||!e.isEditable||P(o.selection)||e.view.dragging?null:m.create(o.doc,[g.inline(o.selection.from,o.selection.to,{class:t.className})])}}})]}});function C({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||t?.type===e}var G=u.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const e=new h(this.name),t=Object.entries(this.editor.schema.nodes).map(([,o])=>o).filter(o=>(this.options.notAfter||[]).concat(this.options.node).includes(o.name));return[new p({key:e,appendTransaction:(o,s,r)=>{const{doc:n,tr:c,schema:i}=r,a=e.getState(r),d=n.content.size,l=i.nodes[this.options.node];if(a)return c.insert(d,l.create())},state:{init:(o,s)=>{const r=s.tr.doc.lastChild;return!C({node:r,types:t})},apply:(o,s)=>{if(!o.docChanged)return s;const r=o.doc.lastChild;return!C({node:r,types:t})}}})]}}),R=u.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>O(e,t),redo:()=>({state:e,dispatch:t})=>N(e,t)}},addProseMirrorPlugins(){return[E(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});export{k as D,F as G,G as T,R as U};
