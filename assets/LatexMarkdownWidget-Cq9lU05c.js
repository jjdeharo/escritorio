import{u as E,r as i,j as r,ao as L,I as M,ap as N,K as S}from"./react-vendor-C9LHBUkp.js";import{d as R}from"./markdown-vendor-Cp29AwN3.js";import{k as p}from"./katex-vendor-e2HE3AXa.js";import{aw as F}from"./vendor-BnVc6iZf.js";import{v as D}from"./index-1oeigWlx.js";import"./editor-vendor-Dlj3R3R2.js";import"./i18n-vendor-BnzbNFM1.js";async function H(){let e="";for(const c of Array.from(document.styleSheets))try{if(c.cssRules)for(const l of Array.from(c.cssRules))e+=l.cssText}catch{}return e}function _(e,c,l){if(e.innerHTML="",c==="markdown"){const s=R.parse(l);e.innerHTML=s,e.innerHTML=e.innerHTML.replace(/\$\$([^$]+)\$\$/g,(w,n)=>p.renderToString(n.trim(),{throwOnError:!1,displayMode:!0})),e.innerHTML=e.innerHTML.replace(/\$([^$]+)\$/g,(w,n)=>p.renderToString(n.trim(),{throwOnError:!1,displayMode:!1}))}else p.render(l,e,{throwOnError:!0,displayMode:!0})}const q=()=>{const{t:e,i18n:c,ready:l}=E(),[s,w]=i.useState(`# Teorema de Pitágoras

En un triángulo rectángulo, el cuadrado de la hipotenusa es igual a la suma de los cuadrados de los catetos.

$$c = \\sqrt{a^2 + b^2}$$`);i.useEffect(()=>{const t=e("widgets.latex_markdown.sample_content");t!=="widgets.latex_markdown.sample_content"&&w(t)},[e,c.language]);const[n,g]=i.useState("markdown"),[h,k]=i.useState(""),x=i.useRef(null),f=i.useRef(null);i.useEffect(()=>{const t=f.current;if(t)return document.body.appendChild(t),()=>{t.parentNode&&t.parentNode.removeChild(t)}},[]);const u=t=>{k(t),setTimeout(()=>k(""),1800)},v=()=>{navigator.clipboard.writeText(s).then(()=>u(e("widgets.latex_markdown.source_copied"))).catch(()=>u(e("widgets.latex_markdown.copy_failed")))},b=async()=>{const t=x.current;if(!t)return;const a=await H();try{const o=await F(t,{backgroundColor:"#ffffff",fontEmbedCSS:a}),m=await(await fetch(o)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":m})]),u(e("widgets.latex_markdown.image_copied"))}catch{u(e("widgets.latex_markdown.copy_image_failed"))}},y=()=>{const t=n==="latex"?"tex":"md",a=n==="latex"?"text/x-latex":"text/markdown",o=new Blob([s],{type:`${a};charset=utf-8`}),m=URL.createObjectURL(o),d=document.createElement("a");d.href=m,d.download=`documento.${t}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m)},j=async()=>{const t=f.current;if(!t)return;_(t,n,s);try{await document.fonts?.ready}catch{}await new Promise(o=>requestAnimationFrame(()=>o()));const a=()=>{t.innerHTML="",window.removeEventListener("afterprint",a)};window.addEventListener("afterprint",a),window.print()};return i.useEffect(()=>{const t=x.current;if(t)try{_(t,n,s)}catch(a){if(n==="latex"&&a instanceof Error){const o=e("widgets.latex_markdown.latex_mode_title"),m=e("widgets.latex_markdown.latex_mode_description"),d=e("widgets.latex_markdown.how_to_proceed"),T=e("widgets.latex_markdown.isolated_formula"),$=e("widgets.latex_markdown.text_with_formulas"),C=e("widgets.latex_markdown.markdown");t.innerHTML=`
          <div class="friendly-error-pane">
            <h3>${o}</h3>
            <p>${m}</p>
            <h4>${d}</h4>
            <ul>
              <li>${T} <code>c = \\\\sqrt{a^2 + b^2}</code>.</li>
              <li>${$} <strong>${C}</strong>.</li>
            </ul>
          </div>
        `}else if(a instanceof Error){const o=e("widgets.latex_markdown.latex_syntax_error");t.innerHTML=`<div class="error-message">${o} ${a.message}</div>`}else{const o=e("widgets.latex_markdown.generic_error");t.innerHTML=`<div class="error-message">${o}</div>`}}},[s,n]),l?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"latex-markdown-widget",children:[r.jsxs("div",{className:"editor-pane",children:[r.jsxs("div",{className:"mode-selector",children:[r.jsx("button",{onClick:()=>g("markdown"),className:n==="markdown"?"active":"",children:"Markdown"}),r.jsx("button",{onClick:()=>g("latex"),className:n==="latex"?"active":"",children:"LaTeX"})]}),r.jsx("textarea",{value:s,onChange:t=>w(t.target.value),spellCheck:"false",className:"editor-textarea"})]}),r.jsxs("div",{className:"preview-container",children:[r.jsxs("div",{className:"preview-toolbar",children:[h&&r.jsx("span",{className:"feedback-message",children:h}),r.jsx("button",{title:e("widgets.latex_markdown.copy_source"),onClick:v,children:r.jsx(L,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.copy_image"),onClick:b,children:r.jsx(M,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.save_file"),onClick:y,children:r.jsx(N,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.export_pdf"),onClick:j,children:r.jsx(S,{size:18})})]}),r.jsx("div",{className:"preview-pane prose",ref:x})]})]}),r.jsx("div",{id:"print-root",ref:f,className:"prose"})]}):r.jsx("div",{className:"flex items-center justify-center h-full",children:e("loading")})};export{q as LatexMarkdownWidget,D as widgetConfig};
