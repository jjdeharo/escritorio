import{u as J,a as Q,r as o,j as n,M as V,b as Z,T as ee}from"./index-DZlaiE3f.js";import{S as pe}from"./index-DZlaiE3f.js";import{P as te}from"./play-D3x89YDH.js";import{E as ne}from"./expand-DVAR8xLm.js";import{P as se}from"./plus-CgqdC8sr.js";const y=()=>`hsl(${Math.random()*360}, 70%, 80%)`,ce=()=>{const{t:c}=J(),[i,p]=Q("spinner-options",[]);o.useEffect(()=>{if(window.localStorage.getItem("spinner-options")===null){const e=c("widgets.random_spinner.default_options",{returnObjects:!0});Array.isArray(e)&&p(e.map(s=>({...s,color:y()})))}},[c,p]);const[_,C]=o.useState(""),[S,I]=o.useState(!1),[k,x]=o.useState(null),[L,b]=o.useState(null),[w,h]=o.useState(""),[g,q]=o.useState(!1),[a,B]=o.useState(300),[R,K]=o.useState(!1),[z,N]=o.useState(null),M=o.useRef(null),E=o.useRef(null),A=o.useRef(null),T=o.useRef(i);o.useEffect(()=>{T.current=i},[i]),o.useEffect(()=>{const t=E.current;if(!t)return;const e=new ResizeObserver(()=>{if(t){const s=Math.min(t.offsetWidth,t.offsetHeight);B(s)}});return e.observe(t),()=>e.disconnect()},[]),o.useEffect(()=>{const t=M.current;if(!t)return;const e=t.getContext("2d");if(!e)return;t.width=a,t.height=a;const s=i.length;if(s===0){e.clearRect(0,0,a,a);return}const d=2*Math.PI/s,f=a/2,l=a/2,r=a/2-10;e.clearRect(0,0,a,a),e.font=`bold ${Math.max(10,a*.05)}px sans-serif`,i.forEach((u,j)=>{const m=j*d;e.beginPath(),e.fillStyle=u.color,e.moveTo(f,l),e.arc(f,l,r,m,m+d),e.closePath(),e.fill(),e.save(),e.fillStyle="#333",e.translate(f,l),e.rotate(m+d/2),e.textAlign="right";const v=u.text.length>15?u.text.substring(0,12)+"...":u.text;e.fillText(v,r-10,0),e.restore()})},[i,a]);const F=()=>{_.trim()&&i.length<20&&(p([...i,{text:_.trim(),color:y()}]),C(""))},W=t=>{const e=t.target.files?.[0];if(!e)return;const s=new FileReader;s.onload=d=>{const l=(d.target?.result??"").split(/\r?\n/).map(r=>r.trim()).filter(Boolean).slice(0,20);p(l.map(r=>({text:r,color:y()}))),x(null),b(null),h("")},s.readAsText(e),t.target.value=""},D=t=>{p(i.filter((e,s)=>s!==t))},H=t=>{b(t),h(i[t].text)},$=t=>{if(w.trim()){const e=[...i];e[t].text=w.trim(),p(e)}b(null),h("")},U=()=>{if(S)return;let t=T.current;if(R&&z){const l=t.findIndex(r=>r.text===z);if(l!==-1){const r=t.filter((u,j)=>j!==l);p(r),t=r}N(null)}if(t.length<2)return;I(!0),x(null);const e=Math.random()*20+20,s=(Math.random()*3+4)*1e3;let d=0;const f=l=>{d||(d=l);const r=l-d,u=Math.min(r/s,1),m=e*(O=>1-Math.pow(1-O,4))(u),v=M.current;if(v&&(v.style.transform=`rotate(${m}rad)`),u<1)requestAnimationFrame(f);else{const O=m%(2*Math.PI),X=2*Math.PI/t.length,Y=((-Math.PI/2-O)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),G=Math.floor(Y/X)%t.length,P=t[G]?.text??null;x(P),R&&P&&N(P),I(!1)}};requestAnimationFrame(f)};return n.jsxs("div",{className:`random-spinner-widget ${g?"fullscreen":""}`,children:[n.jsxs("div",{ref:E,className:"spinner-area",children:[n.jsx("canvas",{ref:M,className:"spinner-canvas"}),n.jsx("div",{className:"spinner-pointer"}),n.jsx("button",{onClick:U,disabled:S||i.length<2,className:"spin-button",children:n.jsx(te,{size:32})}),k&&!S&&n.jsxs("div",{className:"spinner-result",onClick:()=>x(null),children:[n.jsx("span",{children:k}),n.jsx("small",{children:c("widgets.random_spinner.result_overlay_text")})]}),n.jsx("button",{onClick:()=>q(!g),className:"fullscreen-button",title:c(g?"widgets.random_spinner.restore_view_button_title":"widgets.random_spinner.fullscreen_button_title"),children:g?n.jsx(V,{size:16}):n.jsx(ne,{size:16})})]}),n.jsxs("div",{className:"options-manager",children:[n.jsx("div",{className:"options-header",children:n.jsx("h3",{children:c("widgets.random_spinner.options_header")})}),n.jsxs("label",{className:"remove-selected",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:t=>{const e=t.target.checked;K(e),e||N(null)}}),c("widgets.random_spinner.remove_after_select")]}),n.jsxs("div",{className:"add-option",children:[n.jsx("input",{type:"text",value:_,onChange:t=>C(t.target.value),placeholder:c("widgets.random_spinner.add_option_placeholder"),maxLength:20,onKeyPress:t=>t.key==="Enter"&&F()}),n.jsx("button",{onClick:F,children:n.jsx(se,{size:18})})]}),n.jsxs("button",{onClick:()=>A.current?.click(),className:"upload-options-button",children:[n.jsx(Z,{size:16})," ",c("widgets.random_spinner.load_from_file")]}),n.jsx("input",{type:"file",ref:A,onChange:W,accept:".txt",className:"hidden"}),n.jsx("ul",{className:"options-list",children:i.map((t,e)=>n.jsxs("li",{onDoubleClick:()=>H(e),children:[n.jsx("span",{className:"option-color",style:{backgroundColor:t.color}}),L===e?n.jsx("input",{type:"text",value:w,onChange:s=>h(s.target.value),onBlur:()=>$(e),onKeyPress:s=>s.key==="Enter"&&$(e),autoFocus:!0,className:"edit-input"}):n.jsx("span",{className:"option-text",children:t.text}),n.jsx("button",{onClick:()=>D(e),children:n.jsx(ee,{size:14})})]},e))})]})]})};export{ce as RandomSpinnerWidget,pe as widgetConfig};
