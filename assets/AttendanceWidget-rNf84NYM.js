import{c as f,u as z,a as R,r as j,j as e,U,b as B,D as T}from"./index-CPQOxNnm.js";import{w as I}from"./index-CPQOxNnm.js";import{P as _}from"./papaparse.min-DhK9KbGW.js";import{U as M}from"./user-plus-CbInqcM4.js";import{R as P}from"./rotate-ccw-D6JRbam5.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]],O=f("badge",K);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],q=f("triangle-alert",V),G=a=>{const g=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),m=String(a.getDate()).padStart(2,"0");return`${g}-${o}-${m}`},J=()=>{const{t:a,ready:g}=z(),[o,m]=R("attendance-records",{}),[k,y]=j.useState(()=>new Date),[u,h]=j.useState("attendance"),[b,w]=j.useState(""),S=[{id:1,icon:"â­",description:a("widgets.attendance.badges.excellent_work")},{id:2,icon:"ðŸ‘",description:a("widgets.attendance.badges.good_participation")},{id:3,icon:"ðŸŽ¯",description:a("widgets.attendance.badges.goal_achieved")},{id:4,icon:"ðŸ¤",description:a("widgets.attendance.badges.helps_classmates")}],C=[{id:1,icon:"ðŸ’¬",description:a("widgets.attendance.alerts.talks_in_class")},{id:2,icon:"ðŸ˜´",description:a("widgets.attendance.alerts.doesnt_work")},{id:3,icon:"ðŸ˜ ",description:a("widgets.attendance.alerts.bad_behavior")},{id:4,icon:"âœï¸",description:a("widgets.attendance.alerts.incomplete_homework")}];if(!g)return e.jsx("div",{className:"flex items-center justify-center h-full",children:a("loading")});const p=G(k),v=()=>{if(o[p])return o[p];const t=Object.keys(o).sort().pop();return t?o[t].map(({id:s,name:c})=>({id:s,name:c,status:"absent",badges:[],alerts:[]})):[]},r=v(),l=t=>{m(s=>({...s,[p]:t}))},N=()=>{if(b.trim()==="")return;const t={id:Date.now(),name:b.trim(),status:"absent",badges:[],alerts:[]},s=v();l([...s,t]),w("")},x=(t,s)=>{const c=r.map(n=>n.id===t?{...n,status:s}:n);l(c)},A=(t,s)=>{const c=r.map(n=>{if(n.id!==t)return n;const i=n.badges.includes(s)?n.badges.filter(d=>d!==s):[...n.badges,s];return{...n,badges:i}});l(c)},D=(t,s)=>{const c=r.map(n=>{if(n.id!==t)return n;const i=n.alerts.includes(s)?n.alerts.filter(d=>d!==s):[...n.alerts,s];return{...n,alerts:i}});l(c)},E=t=>{const s=t.target.files?.[0];s&&_.parse(s,{header:!0,skipEmptyLines:!0,complete:c=>{const n=c.data.map(i=>({id:Number(i.id)||Date.now()+Math.random(),name:String(i.name||a("widgets.attendance.no_name")),status:"absent",badges:[],alerts:[]}));l(n)}})},L=()=>{const t=[];Object.keys(o).sort().forEach(i=>{o[i].forEach(d=>{t.push({date:i,id:d.id,name:d.name,status:d.status,badges:d.badges.join(";"),alerts:d.alerts.join(";")})})});const s=_.unparse(t),c=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(c),n.download="asistencia_completa.csv",n.click()},F=()=>{window.confirm(a("widgets.attendance.reset_confirm"))&&m({})},$=t=>{switch(u){case"attendance":return e.jsxs("div",{className:"controls attendance-controls",children:[e.jsx("button",{onClick:()=>x(t.id,"present"),className:`status-btn present ${t.status==="present"?"active":""}`,children:a("widgets.attendance.present")}),e.jsx("button",{onClick:()=>x(t.id,"absent"),className:`status-btn absent ${t.status==="absent"?"active":""}`,children:a("widgets.attendance.absent")}),e.jsx("button",{onClick:()=>x(t.id,"late"),className:`status-btn late ${t.status==="late"?"active":""}`,children:a("widgets.attendance.late")})]});case"badges":return e.jsx("div",{className:"controls badge-controls",children:S.map(s=>e.jsx("button",{title:s.description,onClick:()=>A(t.id,s.id),className:`badge-btn ${t.badges.includes(s.id)?"active":""}`,children:s.icon},s.id))});case"alerts":return e.jsx("div",{className:"controls alert-controls",children:C.map(s=>e.jsx("button",{title:s.description,onClick:()=>D(t.id,s.id),className:`alert-btn ${t.alerts.includes(s.id)?"active":""}`,children:s.icon},s.id))})}};return e.jsxs("div",{className:"attendance-widget",children:[e.jsxs("div",{className:"date-controls",children:[e.jsx("label",{htmlFor:"attendance-date",children:a("widgets.attendance.date")}),e.jsx("input",{type:"date",id:"attendance-date",value:p,onChange:t=>{const[s,c,n]=t.target.value.split("-").map(Number);y(new Date(s,c-1,n))}})]}),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{onClick:()=>h("attendance"),className:u==="attendance"?"active":"",children:[e.jsx(U,{size:16})," ",a("widgets.attendance.attendance_tab")]}),e.jsxs("button",{onClick:()=>h("badges"),className:u==="badges"?"active":"",children:[e.jsx(O,{size:16})," ",a("widgets.attendance.badges_tab")]}),e.jsxs("button",{onClick:()=>h("alerts"),className:u==="alerts"?"active":"",children:[e.jsx(q,{size:16})," ",a("widgets.attendance.alerts_tab")]})]}),e.jsx("div",{className:"content-area",children:r.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:a("widgets.attendance.no_students_message")}),e.jsx("p",{className:"text-sm",children:a("widgets.attendance.add_students_instruction")})]}):e.jsx("ul",{className:"student-list",children:r.map(t=>e.jsxs("li",{className:"student-item",children:[e.jsx("span",{className:"student-name",children:t.name}),$(t)]},t.id))})})]}),e.jsxs("div",{className:"footer",children:[e.jsxs("div",{className:"add-student-form",children:[e.jsx("input",{type:"text",value:b,onChange:t=>w(t.target.value),placeholder:a("widgets.attendance.new_student_placeholder"),onKeyPress:t=>t.key==="Enter"&&N()}),e.jsx("button",{onClick:N,children:e.jsx(M,{size:16})})]}),e.jsxs("div",{className:"actions-group",children:[e.jsx("input",{type:"file",id:"csv-upload",accept:".csv",onChange:E,style:{display:"none"}}),e.jsx("label",{htmlFor:"csv-upload",className:"action-btn",title:a("widgets.attendance.import_csv_tooltip"),children:e.jsx(B,{size:16})}),e.jsx("button",{onClick:L,className:"action-btn",title:a("widgets.attendance.export_records_tooltip"),children:e.jsx(T,{size:16})}),e.jsx("button",{onClick:F,className:"action-btn danger",title:a("widgets.attendance.delete_all_tooltip"),children:e.jsx(P,{size:16})})]})]})]})};export{J as AttendanceWidget,I as widgetConfig};
