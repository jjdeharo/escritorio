import{r as c,j as e}from"./vendor-react-CvxLrFbY.js";import{d as T}from"./vendor-marked-IrHqQMcX.js";import{k as E}from"./vendor-katex-KHco_4HN.js";import{o as pe}from"./index-BRUjA2Tl.js";import{u as W}from"./vendor-react-i18next-CV9wn5jO.js";import{F as b,s as C}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";function M(p){const d=[];let u=p.replace(/\$\$([\s\S]+?)\$\$/g,(o,a)=>{const l=d.length;return d.push({id:l,latex:a,displayMode:!0}),`@@LATEX_BLOCK_${l}@@`});u=u.replace(/\$(?!\$)([^\n$]+?)\$/g,(o,a)=>{const l=d.length;return d.push({id:l,latex:a,displayMode:!1}),`@@LATEX_INLINE_${l}@@`});let t=T.parse(u);for(const o of d){const a=o.displayMode?`@@LATEX_BLOCK_${o.id}@@`:`@@LATEX_INLINE_${o.id}@@`,l=E.renderToString(o.latex.trim(),{throwOnError:!1,displayMode:o.displayMode});t=t.split(a).join(l)}return t}const ae=()=>{const{t:p}=W(),d=c.useRef(null),u=c.useRef(null),[t,o]=c.useState("none"),[a,l]=c.useState(""),[i,m]=c.useState(""),[h,x]=c.useState("");c.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const g=()=>{d.current?.click()},R=async n=>{const r=n.target.files?.[0];if(!r)return;i&&URL.revokeObjectURL(i),m(""),x("");const w=r.name,f=w.toLowerCase(),v=r.type.startsWith("image/")||f.match(/\.(png|jpe?g|gif|webp|bmp|svg)$/),y=r.type==="application/pdf"||f.endsWith(".pdf"),U=f.endsWith(".md")||f.endsWith(".markdown"),L=r.type==="text/html"||f.match(/\.(html?|xhtml)$/),_=r.type.startsWith("text/")&&!L||f.endsWith(".txt"),$=r.type.startsWith("video/")||f.match(/\.(mp4|webm|ogg|mov)$/),O=r.type.startsWith("audio/")||f.match(/\.(mp3|wav|ogg|m4a|aac|flac)$/);if(l(w),v){const s=URL.createObjectURL(r);m(s),o("image"),n.target.value="";return}if(y){const s=URL.createObjectURL(r);m(s),o("pdf"),n.target.value="";return}if(U){const s=await r.text();o("markdown"),x(s),m(""),n.target.value="";return}if(L){const s=URL.createObjectURL(r);m(s),o("html"),n.target.value="";return}if(_){const s=await r.text();o("text"),x(s),m(""),n.target.value="";return}if($){const s=URL.createObjectURL(r);m(s),o("video"),n.target.value="";return}if(O){const s=URL.createObjectURL(r);m(s),o("audio"),n.target.value="";return}const k=URL.createObjectURL(r);window.open(k,"_blank"),window.setTimeout(()=>URL.revokeObjectURL(k),6e4),n.target.value=""},j=c.useMemo(()=>t!=="markdown"||!h?"":M(h),[t,h]);c.useEffect(()=>{const n=u.current;n&&(n.innerHTML=j)},[j]);const N=t==="text"||t==="markdown";return e.jsxs("div",{className:"file-opener-widget",children:[e.jsxs("div",{className:"file-opener-header",children:[e.jsx(b,{size:18}),e.jsx("span",{children:a||p("widgets.file_opener.title")}),e.jsx("div",{className:"file-opener-spacer"}),e.jsx("button",{onClick:g,className:"file-opener-button",children:p("widgets.file_opener.open_button")})]}),e.jsxs("div",{className:`file-opener-body${N?" file-opener-body-doc":""}`,onClick:t==="none"?g:void 0,children:[t==="none"&&e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(b,{size:32}),e.jsx("p",{children:p("widgets.file_opener.description")}),e.jsx("p",{className:"file-opener-hint",children:p("widgets.file_opener.supported_formats")})]}),t==="image"&&i&&e.jsx("img",{src:i,alt:a,className:"file-opener-image"}),t==="pdf"&&i&&e.jsx("object",{data:i,type:"application/pdf",className:"file-opener-embed",children:e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(C,{size:24}),e.jsx("p",{children:p("widgets.file_opener.pdf_fallback")})]})}),t==="html"&&i&&e.jsx("iframe",{className:"file-opener-embed",src:i,title:a||p("widgets.file_opener.title"),sandbox:"allow-same-origin allow-scripts allow-forms"}),t==="video"&&i&&e.jsx("video",{className:"file-opener-video",controls:!0,src:i}),t==="audio"&&i&&e.jsx("audio",{className:"file-opener-audio",controls:!0,src:i}),t==="text"&&e.jsx("pre",{className:"file-opener-text",children:h}),t==="markdown"&&e.jsx("div",{className:"file-opener-markdown prose",ref:u})]}),e.jsx("input",{ref:d,type:"file",onChange:R,accept:"image/*,application/pdf,text/plain,text/markdown,text/html,video/*,audio/*,.md,.markdown,.txt,.html,.htm,.xhtml",className:"hidden"})]})};export{ae as FileOpenerWidget,pe as widgetConfig};
