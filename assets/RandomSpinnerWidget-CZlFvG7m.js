import{r as o,j as n}from"./vendor-react-CvxLrFbY.js";import{u as J}from"./index-BRUjA2Tl.js";import{F as ze}from"./index-BRUjA2Tl.js";import{u as Q}from"./vendor-react-i18next-CV9wn5jO.js";import{af as V,b as Z,a7 as ee,aq as te,w as ne,T as se}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";const I=()=>`hsl(${Math.random()*360}, 70%, 80%)`,Ie=()=>{const{t:c}=Q(),[i,p]=J("spinner-options",[]);o.useEffect(()=>{if(window.localStorage.getItem("spinner-options")===null){const e=c("widgets.random_spinner.default_options",{returnObjects:!0});Array.isArray(e)&&p(e.map(s=>({...s,color:I()})))}},[c,p]);const[_,M]=o.useState(""),[b,k]=o.useState(!1),[z,x]=o.useState(null),[q,w]=o.useState(null),[S,h]=o.useState(""),[g,L]=o.useState(!1),[a,B]=o.useState(300),[R,K]=o.useState(!1),[P,N]=o.useState(null),O=o.useRef(null),E=o.useRef(null),A=o.useRef(null),T=o.useRef(i);o.useEffect(()=>{T.current=i},[i]),o.useEffect(()=>{const t=E.current;if(!t)return;const e=new ResizeObserver(()=>{if(t){const s=Math.min(t.offsetWidth,t.offsetHeight);B(s)}});return e.observe(t),()=>e.disconnect()},[]),o.useEffect(()=>{const t=O.current;if(!t)return;const e=t.getContext("2d");if(!e)return;t.width=a,t.height=a;const s=i.length;if(s===0){e.clearRect(0,0,a,a);return}const u=2*Math.PI/s,m=a/2,l=a/2,r=a/2-10;e.clearRect(0,0,a,a),e.font=`bold ${Math.max(10,a*.05)}px sans-serif`,i.forEach((d,j)=>{const f=j*u;e.beginPath(),e.fillStyle=d.color,e.moveTo(m,l),e.arc(m,l,r,f,f+u),e.closePath(),e.fill(),e.save(),e.fillStyle="#333",e.translate(m,l),e.rotate(f+u/2),e.textAlign="right";const v=d.text.length>15?d.text.substring(0,12)+"...":d.text;e.fillText(v,r-10,0),e.restore()})},[i,a]);const F=()=>{_.trim()&&i.length<20&&(p([...i,{text:_.trim(),color:I()}]),M(""))},W=t=>{const e=t.target.files?.[0];if(!e)return;const s=new FileReader;s.onload=u=>{const l=(u.target?.result??"").split(/\r?\n/).map(r=>r.trim()).filter(Boolean).slice(0,20);p(l.map(r=>({text:r,color:I()}))),x(null),w(null),h("")},s.readAsText(e),t.target.value=""},D=t=>{p(i.filter((e,s)=>s!==t))},H=t=>{w(t),h(i[t].text)},$=t=>{if(S.trim()){const e=[...i];e[t].text=S.trim(),p(e)}w(null),h("")},U=()=>{if(b)return;let t=T.current;if(R&&P){const l=t.findIndex(r=>r.text===P);if(l!==-1){const r=t.filter((d,j)=>j!==l);p(r),t=r}N(null)}if(t.length<2)return;k(!0),x(null);const e=Math.random()*20+20,s=(Math.random()*3+4)*1e3;let u=0;const m=l=>{u||(u=l);const r=l-u,d=Math.min(r/s,1),f=e*(y=>1-Math.pow(1-y,4))(d),v=O.current;if(v&&(v.style.transform=`rotate(${f}rad)`),d<1)requestAnimationFrame(m);else{const y=f%(2*Math.PI),X=2*Math.PI/t.length,Y=((-Math.PI/2-y)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),G=Math.floor(Y/X)%t.length,C=t[G]?.text??null;x(C),R&&C&&N(C),k(!1)}};requestAnimationFrame(m)};return n.jsxs("div",{className:`random-spinner-widget ${g?"fullscreen":""}`,children:[n.jsxs("div",{ref:E,className:"spinner-area",children:[n.jsx("canvas",{ref:O,className:"spinner-canvas"}),n.jsx("div",{className:"spinner-pointer"}),n.jsx("button",{onClick:U,disabled:b||i.length<2,className:"spin-button",children:n.jsx(V,{size:32})}),z&&!b&&n.jsxs("div",{className:"spinner-result",onClick:()=>x(null),children:[n.jsx("span",{children:z}),n.jsx("small",{children:c("widgets.random_spinner.result_overlay_text")})]}),n.jsx("button",{onClick:()=>L(!g),className:"fullscreen-button",title:c(g?"widgets.random_spinner.restore_view_button_title":"widgets.random_spinner.fullscreen_button_title"),children:g?n.jsx(Z,{size:16}):n.jsx(ee,{size:16})})]}),n.jsxs("div",{className:"options-manager",children:[n.jsx("div",{className:"options-header",children:n.jsx("h3",{children:c("widgets.random_spinner.options_header")})}),n.jsxs("label",{className:"remove-selected",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:t=>{const e=t.target.checked;K(e),e||N(null)}}),c("widgets.random_spinner.remove_after_select")]}),n.jsxs("div",{className:"add-option",children:[n.jsx("input",{type:"text",value:_,onChange:t=>M(t.target.value),placeholder:c("widgets.random_spinner.add_option_placeholder"),maxLength:20,onKeyPress:t=>t.key==="Enter"&&F()}),n.jsx("button",{onClick:F,children:n.jsx(te,{size:18})})]}),n.jsxs("button",{onClick:()=>A.current?.click(),className:"upload-options-button",children:[n.jsx(ne,{size:16})," ",c("widgets.random_spinner.load_from_file")]}),n.jsx("input",{type:"file",ref:A,onChange:W,accept:".txt",className:"hidden"}),n.jsx("ul",{className:"options-list",children:i.map((t,e)=>n.jsxs("li",{onDoubleClick:()=>H(e),children:[n.jsx("span",{className:"option-color",style:{backgroundColor:t.color}}),q===e?n.jsx("input",{type:"text",value:S,onChange:s=>h(s.target.value),onBlur:()=>$(e),onKeyPress:s=>s.key==="Enter"&&$(e),autoFocus:!0,className:"edit-input"}):n.jsx("span",{className:"option-text",children:t.text}),n.jsx("button",{onClick:()=>D(e),children:n.jsx(se,{size:14})})]},e))})]})]})};export{Ie as RandomSpinnerWidget,ze as widgetConfig};
