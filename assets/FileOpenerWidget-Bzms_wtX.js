import{u as T,r as c,j as e,F as b,p as E}from"./index-BZJQt2-U.js";import{q as H}from"./index-BZJQt2-U.js";import{d as W}from"./marked.esm-IrHqQMcX.js";import{k as C}from"./katex.min-2TduxwG8.js";function M(d){const p=[];let u=d.replace(/\$\$([\s\S]+?)\$\$/g,(r,a)=>{const l=p.length;return p.push({id:l,latex:a,displayMode:!0}),`@@LATEX_BLOCK_${l}@@`});u=u.replace(/\$(?!\$)([^\n$]+?)\$/g,(r,a)=>{const l=p.length;return p.push({id:l,latex:a,displayMode:!1}),`@@LATEX_INLINE_${l}@@`});let t=W.parse(u);for(const r of p){const a=r.displayMode?`@@LATEX_BLOCK_${r.id}@@`:`@@LATEX_INLINE_${r.id}@@`,l=C.renderToString(r.latex.trim(),{throwOnError:!1,displayMode:r.displayMode});t=t.split(a).join(l)}return t}const I=()=>{const{t:d}=T(),p=c.useRef(null),u=c.useRef(null),[t,r]=c.useState("none"),[a,l]=c.useState(""),[i,m]=c.useState(""),[h,x]=c.useState("");c.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const g=()=>{p.current?.click()},R=async o=>{const s=o.target.files?.[0];if(!s)return;i&&URL.revokeObjectURL(i),m(""),x("");const w=s.name,f=w.toLowerCase(),v=s.type.startsWith("image/")||f.match(/\.(png|jpe?g|gif|webp|bmp|svg)$/),y=s.type==="application/pdf"||f.endsWith(".pdf"),U=f.endsWith(".md")||f.endsWith(".markdown"),L=s.type==="text/html"||f.match(/\.(html?|xhtml)$/),_=s.type.startsWith("text/")&&!L||f.endsWith(".txt"),$=s.type.startsWith("video/")||f.match(/\.(mp4|webm|ogg|mov)$/),O=s.type.startsWith("audio/")||f.match(/\.(mp3|wav|ogg|m4a|aac|flac)$/);if(l(w),v){const n=URL.createObjectURL(s);m(n),r("image"),o.target.value="";return}if(y){const n=URL.createObjectURL(s);m(n),r("pdf"),o.target.value="";return}if(U){const n=await s.text();r("markdown"),x(n),m(""),o.target.value="";return}if(L){const n=URL.createObjectURL(s);m(n),r("html"),o.target.value="";return}if(_){const n=await s.text();r("text"),x(n),m(""),o.target.value="";return}if($){const n=URL.createObjectURL(s);m(n),r("video"),o.target.value="";return}if(O){const n=URL.createObjectURL(s);m(n),r("audio"),o.target.value="";return}const k=URL.createObjectURL(s);window.open(k,"_blank"),window.setTimeout(()=>URL.revokeObjectURL(k),6e4),o.target.value=""},j=c.useMemo(()=>t!=="markdown"||!h?"":M(h),[t,h]);c.useEffect(()=>{const o=u.current;o&&(o.innerHTML=j)},[j]);const N=t==="text"||t==="markdown";return e.jsxs("div",{className:"file-opener-widget",children:[e.jsxs("div",{className:"file-opener-header",children:[e.jsx(b,{size:18}),e.jsx("span",{children:a||d("widgets.file_opener.title")}),e.jsx("div",{className:"file-opener-spacer"}),e.jsx("button",{onClick:g,className:"file-opener-button",children:d("widgets.file_opener.open_button")})]}),e.jsxs("div",{className:`file-opener-body${N?" file-opener-body-doc":""}`,onClick:t==="none"?g:void 0,children:[t==="none"&&e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(b,{size:32}),e.jsx("p",{children:d("widgets.file_opener.description")}),e.jsx("p",{className:"file-opener-hint",children:d("widgets.file_opener.supported_formats")})]}),t==="image"&&i&&e.jsx("img",{src:i,alt:a,className:"file-opener-image"}),t==="pdf"&&i&&e.jsx("object",{data:i,type:"application/pdf",className:"file-opener-embed",children:e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(E,{size:24}),e.jsx("p",{children:d("widgets.file_opener.pdf_fallback")})]})}),t==="html"&&i&&e.jsx("iframe",{className:"file-opener-embed",src:i,title:a||d("widgets.file_opener.title"),sandbox:"allow-same-origin allow-scripts allow-forms"}),t==="video"&&i&&e.jsx("video",{className:"file-opener-video",controls:!0,src:i}),t==="audio"&&i&&e.jsx("audio",{className:"file-opener-audio",controls:!0,src:i}),t==="text"&&e.jsx("pre",{className:"file-opener-text",children:h}),t==="markdown"&&e.jsx("div",{className:"file-opener-markdown prose",ref:u})]}),e.jsx("input",{ref:p,type:"file",onChange:R,accept:"image/*,application/pdf,text/plain,text/markdown,text/html,video/*,audio/*,.md,.markdown,.txt,.html,.htm,.xhtml",className:"hidden"})]})};export{I as FileOpenerWidget,H as widgetConfig};
