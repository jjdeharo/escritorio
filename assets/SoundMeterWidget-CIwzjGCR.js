import{r as n,j as e}from"./vendor-react-CvxLrFbY.js";import{J as Z}from"./index-BRUjA2Tl.js";import{u as y}from"./vendor-react-i18next-CV9wn5jO.js";import{as as N,at as b}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";const C={silence:{labelKey:"widgets.sound_meter.silence",emoji:"ðŸ¤«",className:"level-silence"},conversation:{labelKey:"widgets.sound_meter.conversation",emoji:"ðŸ—£ï¸",className:"level-conversation"},noise:{labelKey:"widgets.sound_meter.noise",emoji:"ðŸ’¥",className:"level-noise"}},Q=()=>{const{t:r}=y(),[p,g]=n.useState("silence"),[l,i]=n.useState("prompt"),s=n.useRef(null),a=n.useRef(null),c=n.useRef(void 0),f=t=>t<15?"silence":t<45?"conversation":"noise",v=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(r("widgets.sound_meter.no_audio_support")),i("denied");return}const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});a.current=t;const m=window.AudioContext||window.webkitAudioContext;s.current=new m;const o=s.current.createAnalyser();s.current.createMediaStreamSource(t).connect(o),i("granted");const d=new Uint8Array(o.frequencyBinCount),u=()=>{o.getByteFrequencyData(d);const w=d.reduce((_,h)=>_+h,0)/d.length;g(f(w)),c.current=requestAnimationFrame(u)};u()}catch(t){console.error(r("widgets.sound_meter.microphone_error"),t),i("denied")}},x=()=>{c.current&&cancelAnimationFrame(c.current),a.current&&a.current.getTracks().forEach(t=>t.stop()),s.current&&s.current.state!=="closed"&&s.current.close()};n.useEffect(()=>()=>x(),[]);const j=()=>{if(l==="granted"){const{labelKey:t,emoji:m,className:o}=C[p];return e.jsxs("div",{className:`level-card ${o}`,children:[e.jsx("span",{className:"emoji",children:m}),e.jsx("span",{className:"label",children:r(t)})]})}return e.jsx("div",{className:"permission-screen",children:l==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:48,className:"text-red-500"}),e.jsx("p",{children:r("widgets.sound_meter.access_denied")}),e.jsx("small",{children:r("widgets.sound_meter.enable_browser_settings")})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:48}),e.jsx("p",{children:r("widgets.sound_meter.permission_needed")}),e.jsx("button",{onClick:v,className:"permission-button",children:r("widgets.sound_meter.activate_meter")})]})})};return e.jsx("div",{className:"sound-meter-widget",children:j()})};export{Q as SoundMeterWidget,Z as widgetConfig};
