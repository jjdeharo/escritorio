import{u as T,r as c,j as e,F as b,K as E}from"./react-vendor-C9LHBUkp.js";import{d as W}from"./markdown-vendor-Cp29AwN3.js";import{k as C}from"./katex-vendor-GsVBtP6a.js";import{o as D}from"./index-DIQ32RE2.js";import"./vendor-BnVc6iZf.js";import"./editor-vendor-Dlj3R3R2.js";import"./i18n-vendor-DdbEjq8F.js";function M(d){const p=[];let u=d.replace(/\$\$([\s\S]+?)\$\$/g,(r,a)=>{const l=p.length;return p.push({id:l,latex:a,displayMode:!0}),`@@LATEX_BLOCK_${l}@@`});u=u.replace(/\$(?!\$)([^\n$]+?)\$/g,(r,a)=>{const l=p.length;return p.push({id:l,latex:a,displayMode:!1}),`@@LATEX_INLINE_${l}@@`});let t=W.parse(u);for(const r of p){const a=r.displayMode?`@@LATEX_BLOCK_${r.id}@@`:`@@LATEX_INLINE_${r.id}@@`,l=C.renderToString(r.latex.trim(),{throwOnError:!1,displayMode:r.displayMode});t=t.split(a).join(l)}return t}const H=()=>{const{t:d}=T(),p=c.useRef(null),u=c.useRef(null),[t,r]=c.useState("none"),[a,l]=c.useState(""),[o,m]=c.useState(""),[h,x]=c.useState("");c.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const g=()=>{p.current?.click()},R=async n=>{const s=n.target.files?.[0];if(!s)return;o&&URL.revokeObjectURL(o),m(""),x("");const w=s.name,f=w.toLowerCase(),v=s.type.startsWith("image/")||f.match(/\.(png|jpe?g|gif|webp|bmp|svg)$/),y=s.type==="application/pdf"||f.endsWith(".pdf"),U=f.endsWith(".md")||f.endsWith(".markdown"),L=s.type==="text/html"||f.match(/\.(html?|xhtml)$/),_=s.type.startsWith("text/")&&!L||f.endsWith(".txt"),$=s.type.startsWith("video/")||f.match(/\.(mp4|webm|ogg|mov)$/),O=s.type.startsWith("audio/")||f.match(/\.(mp3|wav|ogg|m4a|aac|flac)$/);if(l(w),v){const i=URL.createObjectURL(s);m(i),r("image"),n.target.value="";return}if(y){const i=URL.createObjectURL(s);m(i),r("pdf"),n.target.value="";return}if(U){const i=await s.text();r("markdown"),x(i),m(""),n.target.value="";return}if(L){const i=URL.createObjectURL(s);m(i),r("html"),n.target.value="";return}if(_){const i=await s.text();r("text"),x(i),m(""),n.target.value="";return}if($){const i=URL.createObjectURL(s);m(i),r("video"),n.target.value="";return}if(O){const i=URL.createObjectURL(s);m(i),r("audio"),n.target.value="";return}const k=URL.createObjectURL(s);window.open(k,"_blank"),window.setTimeout(()=>URL.revokeObjectURL(k),6e4),n.target.value=""},j=c.useMemo(()=>t!=="markdown"||!h?"":M(h),[t,h]);c.useEffect(()=>{const n=u.current;n&&(n.innerHTML=j)},[j]);const N=t==="text"||t==="markdown";return e.jsxs("div",{className:"file-opener-widget",children:[e.jsxs("div",{className:"file-opener-header",children:[e.jsx(b,{size:18}),e.jsx("span",{children:a||d("widgets.file_opener.title")}),e.jsx("div",{className:"file-opener-spacer"}),e.jsx("button",{onClick:g,className:"file-opener-button",children:d("widgets.file_opener.open_button")})]}),e.jsxs("div",{className:`file-opener-body${N?" file-opener-body-doc":""}`,onClick:t==="none"?g:void 0,children:[t==="none"&&e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(b,{size:32}),e.jsx("p",{children:d("widgets.file_opener.description")}),e.jsx("p",{className:"file-opener-hint",children:d("widgets.file_opener.supported_formats")})]}),t==="image"&&o&&e.jsx("img",{src:o,alt:a,className:"file-opener-image"}),t==="pdf"&&o&&e.jsx("object",{data:o,type:"application/pdf",className:"file-opener-embed",children:e.jsxs("div",{className:"file-opener-placeholder",children:[e.jsx(E,{size:24}),e.jsx("p",{children:d("widgets.file_opener.pdf_fallback")})]})}),t==="html"&&o&&e.jsx("iframe",{className:"file-opener-embed",src:o,title:a||d("widgets.file_opener.title"),sandbox:"allow-same-origin allow-scripts allow-forms"}),t==="video"&&o&&e.jsx("video",{className:"file-opener-video",controls:!0,src:o}),t==="audio"&&o&&e.jsx("audio",{className:"file-opener-audio",controls:!0,src:o}),t==="text"&&e.jsx("pre",{className:"file-opener-text",children:h}),t==="markdown"&&e.jsx("div",{className:"file-opener-markdown prose",ref:u})]}),e.jsx("input",{ref:p,type:"file",onChange:R,accept:"image/*,application/pdf,text/plain,text/markdown,text/html,video/*,audio/*,.md,.markdown,.txt,.html,.htm,.xhtml",className:"hidden"})]})};export{H as FileOpenerWidget,D as widgetConfig};
