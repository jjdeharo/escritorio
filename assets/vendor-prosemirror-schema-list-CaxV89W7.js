import{R as h,l as w,c as C,f as R,a as S}from"./vendor-prosemirror-transform-cuuh7Eb1.js";import{F as u,S as I,N as x}from"./vendor-prosemirror-model-Cw4923ok.js";function O(r,t=null){return function(e,l){let{$from:o,$to:n}=e.selection,f=o.blockRange(n);if(!f)return!1;let i=l?e.tr:null;return L(i,f,r,t)?(l&&l(i.scrollIntoView()),!0):!1}}function L(r,t,e,l=null){let o=!1,n=t,f=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let d=f.resolve(t.start-2);n=new x(d,d,t.depth),t.endIndex<t.parent.childCount&&(t=new x(t.$from,f.resolve(t.$to.end(t.depth)),t.depth)),o=!0}let i=R(n,e,l,t);return i?(r&&v(r,t,i,o,e),!0):!1}function v(r,t,e,l,o){let n=u.empty;for(let s=e.length-1;s>=0;s--)n=u.from(e[s].type.create(e[s].attrs,n));r.step(new h(t.start-(l?2:0),t.end,t.start,t.end,new I(n,0,0),e.length,!0));let f=0;for(let s=0;s<e.length;s++)e[s].type==o&&(f=s+1);let i=e.length-f,d=t.start+e.length-(l?2:0),c=t.parent;for(let s=t.startIndex,a=t.endIndex,p=!0;s<a;s++,p=!1)!p&&S(r.doc,d,i)&&(r.split(d,i),d+=2*i),d+=c.child(s).nodeSize;return r}function V(r){return function(t,e){let{$from:l,$to:o}=t.selection,n=l.blockRange(o,f=>f.childCount>0&&f.firstChild.type==r);return n?e?l.node(n.depth-1).type==r?b(t,e,r,n):k(t,e,n):!0:!1}}function b(r,t,e,l){let o=r.tr,n=l.end,f=l.$to.end(l.depth);n<f&&(o.step(new h(n-1,f,n,f,new I(u.from(e.create(null,l.parent.copy())),1,0),1,!0)),l=new x(o.doc.resolve(l.$from.pos),o.doc.resolve(f),l.depth));const i=w(l);if(i==null)return!1;o.lift(l,i);let d=o.doc.resolve(o.mapping.map(n,-1)-1);return C(o.doc,d.pos)&&d.nodeBefore.type==d.nodeAfter.type&&o.join(d.pos),t(o.scrollIntoView()),!0}function k(r,t,e){let l=r.tr,o=e.parent;for(let m=e.end,$=e.endIndex-1,y=e.startIndex;$>y;$--)m-=o.child($).nodeSize,l.delete(m-1,m+1);let n=l.doc.resolve(e.start),f=n.nodeAfter;if(l.mapping.map(e.end)!=e.start+n.nodeAfter.nodeSize)return!1;let i=e.startIndex==0,d=e.endIndex==o.childCount,c=n.node(-1),s=n.index(-1);if(!c.canReplace(s+(i?0:1),s+1,f.content.append(d?u.empty:u.from(o))))return!1;let a=n.pos,p=a+f.nodeSize;return l.step(new h(a-(i?1:0),p+(d?1:0),a+1,p-1,new I((i?u.empty:u.from(o.copy(u.empty))).append(d?u.empty:u.from(o.copy(u.empty))),i?0:1,d?0:1),i?0:1)),t(l.scrollIntoView()),!0}function B(r){return function(t,e){let{$from:l,$to:o}=t.selection,n=l.blockRange(o,c=>c.childCount>0&&c.firstChild.type==r);if(!n)return!1;let f=n.startIndex;if(f==0)return!1;let i=n.parent,d=i.child(f-1);if(d.type!=r)return!1;if(e){let c=d.lastChild&&d.lastChild.type==i.type,s=u.from(c?r.create():null),a=new I(u.from(r.create(null,u.from(i.type.create(null,s)))),c?3:1,0),p=n.start,m=n.end;e(t.tr.step(new h(p-(c?3:1),m,p,m,a,1,!0)).scrollIntoView())}return!0}}export{V as l,B as s,O as w};
