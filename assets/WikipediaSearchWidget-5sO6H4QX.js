import{r as a,j as e}from"./vendor-react-CvxLrFbY.js";import{Q as we}from"./index-BRUjA2Tl.js";import{u as P}from"./vendor-react-i18next-CV9wn5jO.js";import{S as O,E as L}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";const j=[{code:"es",label:"Español"},{code:"ca",label:"Català"},{code:"eu",label:"Euskara"},{code:"gl",label:"Galego"},{code:"pt",label:"Português"},{code:"fr",label:"Français"},{code:"it",label:"Italiano"},{code:"de",label:"Deutsch"},{code:"en",label:"English"}],R=[{value:.9,labelKey:"widgets.wikipedia.text_size_small"},{value:1,labelKey:"widgets.wikipedia.text_size_normal"},{value:1.2,labelKey:"widgets.wikipedia.text_size_large"},{value:1.4,labelKey:"widgets.wikipedia.text_size_xlarge"},{value:1.6,labelKey:"widgets.wikipedia.text_size_xxlarge"}],b=s=>j.find(d=>d.code===s)??j[0],oe=()=>{const{t:s,i18n:d}=P(),[p,C]=a.useState(""),[m,h]=a.useState([]),[o,k]=a.useState(!1),[g,x]=a.useState(!1),[r,z]=a.useState(""),[l,u]=a.useState(null),[f,c]=a.useState(!1),[n,y]=a.useState(()=>b(d.language)),[v,K]=a.useState(!1),[N,T]=a.useState(1);a.useEffect(()=>{v||y(b(d.language))},[d.language,v]);const _=async(i,t)=>{const S=i.trim();if(!S){h([]),x(!1),k(!1);return}k(!0),x(!1);try{const E=await fetch(`https://${t}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(S)}&format=json&origin=*&utf8=1&srlimit=10`);if(!E.ok)throw new Error("wiki fetch failed");const D=((await E.json())?.query?.search||[]).map(w=>({title:w.title,snippet:(w.snippet||"").replace(/<[^>]*>/g,""),url:`https://${t}.wikipedia.org/?curid=${w.pageid}`,pageid:w.pageid}));h(D)}catch{x(!0),h([])}finally{k(!1)}};a.useEffect(()=>{r&&_(r,n.code)},[n.code]);const I=i=>{i.preventDefault(),z(p.trim()),u(null),c(!1),_(p,n.code)},q=a.useMemo(()=>s("widgets.wikipedia.results_title",{lang:n.label}),[n.label,s]);return e.jsxs("section",{className:"wiki-widget",style:{"--wiki-text-scale":N},children:[e.jsxs("header",{className:"wiki-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"wiki-title",children:s("widgets.wikipedia.title")}),e.jsx("div",{className:"wiki-subtitle",children:s("widgets.wikipedia.subtitle")})]}),e.jsxs("form",{className:"wiki-search",onSubmit:I,children:[e.jsx("label",{className:"wiki-label",htmlFor:"wiki-query",children:s("widgets.wikipedia.search_label")}),e.jsxs("div",{className:"wiki-input-row",children:[e.jsxs("div",{className:"wiki-input-wrap",children:[e.jsx(O,{size:18}),e.jsx("input",{id:"wiki-query",type:"text",value:p,onChange:i=>C(i.target.value),placeholder:s("widgets.wikipedia.search_placeholder")})]}),e.jsx("select",{className:"wiki-select",value:n.code,onChange:i=>{y(b(i.target.value)),K(!0)},"aria-label":s("widgets.wikipedia.language_label"),children:j.map(i=>e.jsx("option",{value:i.code,children:i.label},i.code))}),e.jsx("button",{className:"wiki-button",type:"submit",disabled:!p.trim(),children:s("widgets.wikipedia.search_button")})]}),e.jsx("div",{className:"wiki-hint",children:s("widgets.wikipedia.search_hint")})]})]}),e.jsxs("div",{className:"wiki-results",children:[e.jsxs("div",{className:"wiki-results-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:q}),r&&e.jsx("span",{children:s("widgets.wikipedia.results_for",{query:r})})]}),e.jsxs("div",{className:"wiki-results-controls",children:[e.jsx("select",{className:"wiki-scale-select",value:N,onChange:i=>T(Number(i.target.value)),"aria-label":s("widgets.wikipedia.text_size_label"),children:R.map(i=>e.jsx("option",{value:i.value,children:s(i.labelKey)},i.labelKey))}),l&&e.jsx("button",{type:"button",className:"wiki-back-button",onClick:()=>{u(null),c(!1)},children:s("widgets.wikipedia.back_to_results")})]})]}),l?e.jsxs("div",{className:"wiki-article",children:[e.jsxs("div",{className:"wiki-article-header",children:[e.jsx("h4",{children:l.title}),e.jsxs("button",{type:"button",className:"wiki-summary-button",onClick:()=>window.open(l.url,"_blank","noopener,noreferrer"),children:[e.jsx(L,{size:16}),s("widgets.wikipedia.open_new_tab")]})]}),e.jsxs("div",{className:"wiki-article-body",children:[f&&e.jsx("div",{className:"wiki-empty",children:s("widgets.wikipedia.article_blocked")}),!f&&e.jsx("iframe",{src:l.url,title:l.title,className:"wiki-iframe",loading:"lazy",onLoad:()=>c(!1),onError:()=>c(!0)},l.url)]})]}):e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"wiki-empty",children:s("widgets.wikipedia.loading")}),!o&&g&&e.jsx("div",{className:"wiki-empty",children:s("widgets.wikipedia.load_error")}),!o&&!g&&r&&m.length===0&&e.jsx("div",{className:"wiki-empty",children:s("widgets.wikipedia.no_results")}),!o&&!g&&m.length>0&&e.jsx("ul",{className:"wiki-list",children:m.map(i=>e.jsxs("li",{className:"wiki-card",role:"button",tabIndex:0,onClick:()=>{u(i),c(!1)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),u(i),c(!1))},children:[e.jsxs("div",{children:[e.jsx("h4",{children:i.title}),e.jsx("p",{children:i.snippet})]}),e.jsx("div",{className:"wiki-card-actions",children:e.jsx("a",{className:"wiki-link-icon",href:i.url,target:"_blank",rel:"noopener noreferrer",onClick:t=>t.stopPropagation(),onMouseDown:t=>t.stopPropagation(),onKeyDown:t=>t.stopPropagation(),"aria-label":s("widgets.wikipedia.open_article"),title:s("widgets.wikipedia.open_article"),children:e.jsx(L,{size:16})})})]},i.url))}),!r&&!o&&e.jsx("div",{className:"wiki-empty",children:s("widgets.wikipedia.empty_state")})]})]})]})};export{oe as WikipediaSearchWidget,we as widgetConfig};
