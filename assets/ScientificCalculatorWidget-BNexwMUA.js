import{u as T,r as l,j as i}from"./index-D8JS3eog.js";import{V as Q}from"./index-D8JS3eog.js";const H=["7","8","9","÷","4","5","6","×","1","2","3","−","0",".","+","Ans","="],X=["(",")","√","÷","7","8","9","×","4","5","6","−","1","2","3","+","0",".","empty_slot","^","Ans","="],q=["rad/deg","x!","(",")","÷","sin","cos","tan","π","×","log","ln","EE","Ans","−","7","8","9","√","+","4","5","6","^","1","2","3","%","0",".","="],y=["=","+","−","×","÷","^","%"],b=["0","1","2","3","4","5","6","7","8","9","."],V=()=>{const{t:p,ready:A}=T(),[d,a]=l.useState("0"),[u,o]=l.useState(""),[N,M]=l.useState(!0),[r,S]=l.useState("Scientific"),[w,k]=l.useState([]),[g,R]=l.useState(!1),[z,I]=l.useState("0"),$=l.useRef(null),x=l.useRef(null),_=64,L=16,j=1,E=()=>{const e=$.current;if(!e)return;let s=_;for(e.style.fontSize=`${s}px`;e.scrollWidth>e.clientWidth&&s>L;)s-=j,e.style.fontSize=`${s}px`;for(;e.scrollWidth<=e.clientWidth&&s+j<=_;){const t=s+j;if(e.style.fontSize=`${t}px`,e.scrollWidth>e.clientWidth){e.style.fontSize=`${s}px`;break}s=t}};l.useLayoutEffect(()=>{E()},[d,r,g]),l.useEffect(()=>{const e=$.current;if(!e)return;x.current?.disconnect(),x.current=new ResizeObserver(()=>E()),x.current.observe(e);const s=()=>E();return window.addEventListener("resize",s),()=>{x.current?.disconnect(),window.removeEventListener("resize",s)}},[]);const h=e=>{try{let s=e.replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-").replace(/\^/g,"**").replace(/%/g,"*0.01").replace(/π/g,"Math.PI").replace(/Ans/g,z);s=s.replace(/(sin|cos|tan)\(([^)]+)\)/g,(f,c,n)=>{const m=h(n);return N?`Math.${c}(${m})`:`Math.${c}(${m} * Math.PI / 180)`}),s=s.replace(/√\(([^)]+)\)/g,(f,c)=>`Math.sqrt(${h(c)})`),s=s.replace(/log\(([^)]+)\)/g,(f,c)=>`Math.log10(${h(c)})`),s=s.replace(/ln\(([^)]+)\)/g,(f,c)=>`Math.log(${h(c)})`),s=s.replace(/(\d+(?:\.\d+)?)!/g,(f,c)=>{if(c.includes("."))return"Error";let n=parseInt(c);if(n>20)return"Infinity";if(n<0)return"Error";if(n===0)return"1";let m=1;for(let v=2;v<=n;v++)m*=v;return m.toString()});const t=new Function("return "+s)();return t===0?"0":Math.abs(t)>1e12||Math.abs(t)<1e-9&&t!==0?t.toExponential(9):String(parseFloat(t.toFixed(10)))}catch{return"Error"}},W=()=>{d.length>1?(a(d.slice(0,-1)),o(u.slice(0,-1))):(a("0"),o(""))},B=()=>{a("0"),o("")},F=e=>{if(e==="rad/deg"){M(!N);return}if(e==="="){const s=u||d,t=h(s);a(t),o(s+"="),I(t);const f=`${s} = ${t}`;k(c=>[f,...c].slice(0,20))}else["Ans","EE","π"].includes(e)?C(e):["sin","cos","tan","log","ln","√"].includes(e)?O(e):e==="x!"?(o(s=>s+"!"),a(s=>s+"!")):C(e)},C=e=>{if(d==="Error"||u.includes("=")&&!y.includes(e)){a(e),o(e);return}const s=y.includes(u.slice(-1));y.includes(e)&&s||(d==="0"&&e!=="."||s||u.endsWith("(")?a(e):a(t=>t+e),u.includes("=")?o(e):o(t=>t+e))},O=e=>{const s=e+"(";d==="Error"||u.includes("=")||d==="0"?(a(s),o(s)):(a(t=>t+s),o(t=>t+s))},P=r==="Basic"?H:r==="Standard"?X:q,D=r==="Scientific"?"grid-cols-5":"grid-cols-4";return A?i.jsxs("div",{className:"scientific-calculator",children:[i.jsxs("div",{className:"top-bar",children:[i.jsxs("div",{className:"mode-selector",children:[i.jsx("button",{className:`mode-button ${r==="Basic"?"mode-active":""}`,onClick:()=>S("Basic"),children:p("widgets.scientific_calculator.basic")}),i.jsx("button",{className:`mode-button ${r==="Standard"?"mode-active":""}`,onClick:()=>S("Standard"),children:p("widgets.scientific_calculator.standard")}),i.jsx("button",{className:`mode-button ${r==="Scientific"?"mode-active":""}`,onClick:()=>S("Scientific"),children:p("widgets.scientific_calculator.scientific")})]}),r==="Scientific"&&i.jsx("span",{className:"angle-mode-indicator",children:N?"RAD":"DEG"}),i.jsx("button",{className:`mode-button history-toggle ${g?"mode-active":""}`,onClick:()=>R(!g),children:p("widgets.scientific_calculator.history")})]}),g&&i.jsx("div",{className:"history-panel",children:w.length===0?i.jsx("p",{className:"history-empty",children:p("widgets.scientific_calculator.no_history")}):w.map((e,s)=>i.jsx("p",{className:"history-entry",children:e},s))}),i.jsxs("div",{className:"display-area",children:[i.jsx("div",{className:"expression",children:u.replace(/\*/g,"×").replace(/-/g,"−")}),i.jsx("div",{ref:$,className:"main-display",children:d})]}),i.jsxs("div",{className:"top-controls",children:[i.jsx("button",{onClick:W,className:"calc-button control",children:"←"}),i.jsx("button",{onClick:B,className:"calc-button ac",children:"AC"})]}),i.jsx("div",{className:`buttons-grid ${D}`,children:P.map((e,s)=>{if(e==="empty_slot")return i.jsx("div",{className:"calc-button number"},`${r}-empty-${s}`);const t=y.includes(e),f=b.includes(e);let c="function";e==="="?c="equals":t?c="operator":f&&(c="number");let n="";return r==="Basic"?(e==="."&&(n="col-span-2"),e==="Ans"&&(n="col-span-3")):r==="Standard"?e==="Ans"&&(n="col-span-3"):r==="Scientific"&&((e==="6"||e==="3")&&(n="col-span-2"),e==="."&&(n="col-span-2"),e==="="&&(n="col-span-2")),i.jsx("button",{onClick:()=>F(e),className:`calc-button ${c} ${n}`,children:e},`${r}-${e}-${s}`)})})]}):i.jsx("div",{className:"flex items-center justify-center h-full",children:p("loading")})};export{V as ScientificCalculatorWidget,Q as widgetConfig};
