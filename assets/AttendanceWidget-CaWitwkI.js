import{r as j,j as t}from"./vendor-react-CvxLrFbY.js";import{u as R}from"./index-BRUjA2Tl.js";import{w as xt}from"./index-BRUjA2Tl.js";import{P as f}from"./vendor-papaparse-D7EnbpYv.js";import{u as $}from"./vendor-react-i18next-CV9wn5jO.js";import{U as z,J as B,K as U,N as T,w as K,D as P,R as O}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";const M=a=>{const g=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),m=String(a.getDate()).padStart(2,"0");return`${g}-${o}-${m}`},gt=()=>{const{t:a,ready:g}=$(),[o,m]=R("attendance-records",{}),[_,S]=j.useState(()=>new Date),[p,b]=j.useState("attendance"),[h,w]=j.useState(""),k=[{id:1,icon:"â­",description:a("widgets.attendance.badges.excellent_work")},{id:2,icon:"ðŸ‘",description:a("widgets.attendance.badges.good_participation")},{id:3,icon:"ðŸŽ¯",description:a("widgets.attendance.badges.goal_achieved")},{id:4,icon:"ðŸ¤",description:a("widgets.attendance.badges.helps_classmates")}],y=[{id:1,icon:"ðŸ’¬",description:a("widgets.attendance.alerts.talks_in_class")},{id:2,icon:"ðŸ˜´",description:a("widgets.attendance.alerts.doesnt_work")},{id:3,icon:"ðŸ˜ ",description:a("widgets.attendance.alerts.bad_behavior")},{id:4,icon:"âœï¸",description:a("widgets.attendance.alerts.incomplete_homework")}];if(!g)return t.jsx("div",{className:"flex items-center justify-center h-full",children:a("loading")});const u=M(_),v=()=>{if(o[u])return o[u];const e=Object.keys(o).sort().pop();return e?o[e].map(({id:s,name:i})=>({id:s,name:i,status:"absent",badges:[],alerts:[]})):[]},r=v(),l=e=>{m(s=>({...s,[u]:e}))},N=()=>{if(h.trim()==="")return;const e={id:Date.now(),name:h.trim(),status:"absent",badges:[],alerts:[]},s=v();l([...s,e]),w("")},x=(e,s)=>{const i=r.map(n=>n.id===e?{...n,status:s}:n);l(i)},C=(e,s)=>{const i=r.map(n=>{if(n.id!==e)return n;const c=n.badges.includes(s)?n.badges.filter(d=>d!==s):[...n.badges,s];return{...n,badges:c}});l(i)},A=(e,s)=>{const i=r.map(n=>{if(n.id!==e)return n;const c=n.alerts.includes(s)?n.alerts.filter(d=>d!==s):[...n.alerts,s];return{...n,alerts:c}});l(i)},D=e=>{const s=e.target.files?.[0];s&&f.parse(s,{header:!0,skipEmptyLines:!0,complete:i=>{const n=i.data.map(c=>({id:Number(c.id)||Date.now()+Math.random(),name:String(c.name||a("widgets.attendance.no_name")),status:"absent",badges:[],alerts:[]}));l(n)}})},E=()=>{const e=[];Object.keys(o).sort().forEach(c=>{o[c].forEach(d=>{e.push({date:c,id:d.id,name:d.name,status:d.status,badges:d.badges.join(";"),alerts:d.alerts.join(";")})})});const s=f.unparse(e),i=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.download="asistencia_completa.csv",n.click()},L=()=>{window.confirm(a("widgets.attendance.reset_confirm"))&&m({})},F=e=>{switch(p){case"attendance":return t.jsxs("div",{className:"controls attendance-controls",children:[t.jsx("button",{onClick:()=>x(e.id,"present"),className:`status-btn present ${e.status==="present"?"active":""}`,children:a("widgets.attendance.present")}),t.jsx("button",{onClick:()=>x(e.id,"absent"),className:`status-btn absent ${e.status==="absent"?"active":""}`,children:a("widgets.attendance.absent")}),t.jsx("button",{onClick:()=>x(e.id,"late"),className:`status-btn late ${e.status==="late"?"active":""}`,children:a("widgets.attendance.late")})]});case"badges":return t.jsx("div",{className:"controls badge-controls",children:k.map(s=>t.jsx("button",{title:s.description,onClick:()=>C(e.id,s.id),className:`badge-btn ${e.badges.includes(s.id)?"active":""}`,children:s.icon},s.id))});case"alerts":return t.jsx("div",{className:"controls alert-controls",children:y.map(s=>t.jsx("button",{title:s.description,onClick:()=>A(e.id,s.id),className:`alert-btn ${e.alerts.includes(s.id)?"active":""}`,children:s.icon},s.id))})}};return t.jsxs("div",{className:"attendance-widget",children:[t.jsxs("div",{className:"date-controls",children:[t.jsx("label",{htmlFor:"attendance-date",children:a("widgets.attendance.date")}),t.jsx("input",{type:"date",id:"attendance-date",value:u,onChange:e=>{const[s,i,n]=e.target.value.split("-").map(Number);S(new Date(s,i-1,n))}})]}),t.jsxs("div",{className:"main-content",children:[t.jsxs("div",{className:"tabs",children:[t.jsxs("button",{onClick:()=>b("attendance"),className:p==="attendance"?"active":"",children:[t.jsx(z,{size:16})," ",a("widgets.attendance.attendance_tab")]}),t.jsxs("button",{onClick:()=>b("badges"),className:p==="badges"?"active":"",children:[t.jsx(B,{size:16})," ",a("widgets.attendance.badges_tab")]}),t.jsxs("button",{onClick:()=>b("alerts"),className:p==="alerts"?"active":"",children:[t.jsx(U,{size:16})," ",a("widgets.attendance.alerts_tab")]})]}),t.jsx("div",{className:"content-area",children:r.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("p",{children:a("widgets.attendance.no_students_message")}),t.jsx("p",{className:"text-sm",children:a("widgets.attendance.add_students_instruction")})]}):t.jsx("ul",{className:"student-list",children:r.map(e=>t.jsxs("li",{className:"student-item",children:[t.jsx("span",{className:"student-name",children:e.name}),F(e)]},e.id))})})]}),t.jsxs("div",{className:"footer",children:[t.jsxs("div",{className:"add-student-form",children:[t.jsx("input",{type:"text",value:h,onChange:e=>w(e.target.value),placeholder:a("widgets.attendance.new_student_placeholder"),onKeyPress:e=>e.key==="Enter"&&N()}),t.jsx("button",{onClick:N,children:t.jsx(T,{size:16})})]}),t.jsxs("div",{className:"actions-group",children:[t.jsx("input",{type:"file",id:"csv-upload",accept:".csv",onChange:D,style:{display:"none"}}),t.jsx("label",{htmlFor:"csv-upload",className:"action-btn",title:a("widgets.attendance.import_csv_tooltip"),children:t.jsx(K,{size:16})}),t.jsx("button",{onClick:E,className:"action-btn",title:a("widgets.attendance.export_records_tooltip"),children:t.jsx(P,{size:16})}),t.jsx("button",{onClick:L,className:"action-btn danger",title:a("widgets.attendance.delete_all_tooltip"),children:t.jsx(O,{size:16})})]})]})]})};export{gt as AttendanceWidget,xt as widgetConfig};
