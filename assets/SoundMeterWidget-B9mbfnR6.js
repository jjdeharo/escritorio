import{c as v,u as k,r,j as e}from"./index-L4OskYbw.js";import{Z as D}from"./index-L4OskYbw.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],N=v("mic-off",M);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],C=v("mic",b),A={silence:{labelKey:"widgets.sound_meter.silence",emoji:"ðŸ¤«",className:"level-silence"},conversation:{labelKey:"widgets.sound_meter.conversation",emoji:"ðŸ—£ï¸",className:"level-conversation"},noise:{labelKey:"widgets.sound_meter.noise",emoji:"ðŸ’¥",className:"level-noise"}},E=()=>{const{t:s}=k(),[x,g]=r.useState("silence"),[u,o]=r.useState("prompt"),n=r.useRef(null),a=r.useRef(null),c=r.useRef(void 0),p=t=>t<15?"silence":t<45?"conversation":"noise",y=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(s("widgets.sound_meter.no_audio_support")),o("denied");return}const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});a.current=t;const d=window.AudioContext||window.webkitAudioContext;n.current=new d;const i=n.current.createAnalyser();n.current.createMediaStreamSource(t).connect(i),o("granted");const l=new Uint8Array(i.frequencyBinCount),m=()=>{i.getByteFrequencyData(l);const j=l.reduce((w,_)=>w+_,0)/l.length;g(p(j)),c.current=requestAnimationFrame(m)};m()}catch(t){console.error(s("widgets.sound_meter.microphone_error"),t),o("denied")}},f=()=>{c.current&&cancelAnimationFrame(c.current),a.current&&a.current.getTracks().forEach(t=>t.stop()),n.current&&n.current.state!=="closed"&&n.current.close()};r.useEffect(()=>()=>f(),[]);const h=()=>{if(u==="granted"){const{labelKey:t,emoji:d,className:i}=A[x];return e.jsxs("div",{className:`level-card ${i}`,children:[e.jsx("span",{className:"emoji",children:d}),e.jsx("span",{className:"label",children:s(t)})]})}return e.jsx("div",{className:"permission-screen",children:u==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:48,className:"text-red-500"}),e.jsx("p",{children:s("widgets.sound_meter.access_denied")}),e.jsx("small",{children:s("widgets.sound_meter.enable_browser_settings")})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:48}),e.jsx("p",{children:s("widgets.sound_meter.permission_needed")}),e.jsx("button",{onClick:y,className:"permission-button",children:s("widgets.sound_meter.activate_meter")})]})})};return e.jsx("div",{className:"sound-meter-widget",children:h()})};export{E as SoundMeterWidget,D as widgetConfig};
