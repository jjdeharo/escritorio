import{c as M,u as $e,r as i,j as r,n as Xe,T as Ye}from"./index-DJ1oBXhz.js";import{o as gt}from"./index-DJ1oBXhz.js";import{C as De}from"./circle-C0LJtIXP.js";import{R as Ee}from"./rotate-ccw-RbcbMHHa.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Le=M("arrow-right",Be);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],He=M("chart-line",Oe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],qe=M("eraser",We);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]],Fe=M("highlighter",Ae);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Ve=M("move",Ue);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]],Ke=M("paintbrush",Je);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Qe=M("pen",Ge);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],et=M("save",Ze);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M3 3h.01",key:"159qn6"}],["path",{d:"M7 5h.01",key:"1hq22a"}],["path",{d:"M11 7h.01",key:"1osv80"}],["path",{d:"M3 7h.01",key:"1xzrh3"}],["path",{d:"M7 9h.01",key:"19b3jx"}],["path",{d:"M3 11h.01",key:"1eifu7"}],["rect",{width:"4",height:"4",x:"15",y:"5",key:"mri9e4"}],["path",{d:"m19 9 2 2v10c0 .6-.4 1-1 1h-6c-.6 0-1-.4-1-1V11l2-2",key:"aib6hk"}],["path",{d:"m13 14 8-2",key:"1d7bmk"}],["path",{d:"m13 19 8-2",key:"1y2vml"}]],at=M("spray-can",tt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],st=M("square",nt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],it=M("type",rt),lt=()=>{const{t:h}=$e(),w=i.useRef(null),m=i.useRef(null),[Z,H]=i.useState(!1),[R,we]=i.useState("#000000"),[j,me]=i.useState(5),[z,ee]=i.useState("draw"),[u,N]=i.useState("pencil"),[f,te]=i.useState(null),[k,fe]=i.useState(0),[y,xe]=i.useState(0),[T,X]=i.useState(null),[ae,W]=i.useState(!1),[q,Y]=i.useState(""),[ne,be]=i.useState(0),[se,ke]=i.useState(0),re=i.useRef(null),[A,ye]=i.useState(!0),[_,F]=i.useState({x:0,y:0}),[v,ve]=i.useState(!1),C=i.useRef(null),[U,V]=i.useState(!1),D=i.useRef(typeof window<"u"&&window.devicePixelRatio||1),E=i.useRef(_),J=i.useRef(U);E.current=_,J.current=U;const b=i.useCallback(()=>{A&&ye(!1)},[A]),[$,S]=i.useState(null),B=i.useCallback((e,t)=>{if(!w.current||!C.current)return;const a=w.current,n=C.current,s=a.getContext("2d");if(s){s.clearRect(0,0,a.width,a.height);const c=D.current||1,o=Math.max(0,Math.round(e*c)),d=Math.max(0,Math.round(t*c)),g=Math.min(a.width,n.width-o),l=Math.min(a.height,n.height-d);g>0&&l>0&&s.drawImage(n,o,d,g,l,0,0,g,l)}},[]),Ce=i.useCallback(()=>{F({x:0,y:0}),B(0,0)},[B]),Me=i.useCallback(()=>{ve(!v),v||S(null)},[v]),K=i.useCallback(()=>(C.current||(C.current=document.createElement("canvas")),C.current),[]),L=i.useCallback(()=>{const e=w.current;if(!e)return;const t=K(),a=E.current,n=D.current||1,s=Math.max(e.width+Math.abs(Math.round(a.x*n)),t.width||0),c=Math.max(e.height+Math.abs(Math.round(a.y*n)),t.height||0);if(t.width<s||t.height<c){const d=document.createElement("canvas");d.width=s,d.height=c;const g=d.getContext("2d");if(g){J.current&&t.width>0&&t.height>0&&g.drawImage(t,0,0),t.width=s,t.height=c;const l=t.getContext("2d");l&&(l.clearRect(0,0,s,c),l.drawImage(d,0,0))}}const o=t.getContext("2d");if(o){const d=Math.max(0,Math.round(a.x*n)),g=Math.max(0,Math.round(a.y*n));o.drawImage(e,0,0,e.width,e.height,d,g,e.width,e.height)}V(!0)},[K]),ie=i.useCallback(e=>{const t=w.current;if(!t)return{x:0,y:0};const a=t.getBoundingClientRect();return{x:e.clientX-a.left,y:e.clientY-a.top}},[]),ce=i.useCallback(e=>{const t=w.current;if(!t)return{x:0,y:0};const a=t.getBoundingClientRect(),n=t.width/a.width,s=t.height/a.height;return{x:(e.clientX-a.left)*n+_.x*n,y:(e.clientY-a.top)*s+_.y*s}},[_]),_e=i.useCallback(e=>{const t=w.current;if(!t)return{x:0,y:0};const a=t.getBoundingClientRect(),n=t.width/a.width,s=t.height/a.height;return{x:(e.clientX-a.left)*n+_.x*n,y:(e.clientY-a.top)*s+_.y*s}},[_]),oe=i.useCallback((e=!1)=>{const t=w.current,a=m.current;if(!t||!a)return;let n=null;if(e&&(n=a.getImageData(0,0,t.width,t.height)),e||a.clearRect(0,0,t.width,t.height),f){const s=t.width/f.width,c=t.height/f.height,o=Math.min(s,c),d=(t.width-f.width*o)/2,g=(t.height-f.height*o)/2;if(e&&n){const l=document.createElement("canvas");l.width=t.width,l.height=t.height;const x=l.getContext("2d");x&&(x.drawImage(f,0,0,f.width,f.height,d,g,f.width*o,f.height*o),x.putImageData(n,0,0),a.clearRect(0,0,t.width,t.height),a.drawImage(l,0,0))}else a.drawImage(f,0,0,f.width,f.height,d,g,f.width*o,f.height*o)}else e&&n&&a.putImageData(n,0,0)},[f]);i.useEffect(()=>{const e=w.current;if(!e)return;const t=()=>{const s=e.offsetWidth,c=e.offsetHeight,o=(typeof window<"u"?window.devicePixelRatio:1)||1;if(D.current=o,s<=0||c<=0)return;const d=Math.round(s*o),g=Math.round(c*o);if(e.width!==d||e.height!==g){const l=E.current,x=Math.max(0,Math.round(l.x*o)),I=Math.max(0,Math.round(l.y*o)),p=K();((ge,pe)=>{if(p.width>=ge&&p.height>=pe)return;const P=document.createElement("canvas");P.width=Math.max(ge,p.width),P.height=Math.max(pe,p.height);const G=P.getContext("2d");G&&p.width>0&&p.height>0&&G.drawImage(p,0,0),p.width=P.width,p.height=P.height;const Q=p.getContext("2d");Q&&G&&(Q.clearRect(0,0,p.width,p.height),Q.drawImage(P,0,0))})(x+e.width,I+e.height);const O=p.getContext("2d");O&&e.width>0&&e.height>0&&(O.drawImage(e,0,0,e.width,e.height,x,I,e.width,e.height),J.current=!0,V(!0)),e.width=d,e.height=g,m.current=e.getContext("2d"),B(l.x,l.y)}},a=e.getContext("2d");if(!a)return;m.current=a,t();const n=new ResizeObserver(()=>{t()});return n.observe(e.parentElement||e),window.addEventListener("resize",t),()=>{n.disconnect(),window.removeEventListener("resize",t)}},[]),i.useEffect(()=>{m.current&&(m.current.globalCompositeOperation=z==="draw"?"source-over":"destination-out")},[z]);const je=e=>{if(b(),v){const n=ie(e);S(n);return}if(u==="text"&&ae||!m.current||!w.current)return;const{x:t,y:a}=ce(e);u==="text"?(W(!0),be(t),ke(a),Y(""),X(m.current.getImageData(0,0,w.current.width,w.current.height)),setTimeout(()=>re.current?.focus(),0)):["line","rectangle","circle","arrow"].includes(u)?(fe(t),xe(a),X(m.current.getImageData(0,0,w.current.width,w.current.height))):(m.current.beginPath(),m.current.moveTo(t,a)),H(!0)},de=(e,t,a,n,s)=>{e.save(),e.beginPath(),e.translate(t,a),e.rotate(n),e.moveTo(0,0),e.lineTo(-s,-s/2),e.lineTo(-s,s/2),e.closePath(),e.fill(),e.restore()},Ne=e=>{if(v&&$){const s=ie(e),c=s.x-$.x,o=s.y-$.y;if(U&&C.current){const l=C.current.getContext("2d"),x=w.current;if(l&&x){const I=E.current,p=D.current||1,ue=Math.max(0,Math.round(I.x*p)),O=Math.max(0,Math.round(I.y*p));l.drawImage(x,0,0,x.width,x.height,ue,O,x.width,x.height)}}const d={x:_.x-c,y:_.y-o};F(d),B(d.x,d.y),S(s);return}if(!Z||!m.current)return;const{x:t,y:a}=ce(e),n=m.current;if(n.lineWidth=j,n.strokeStyle=R,n.fillStyle=R,T&&["line","rectangle","circle","arrow"].includes(u)){n.putImageData(T,0,0);const s=t-k,c=a-y;switch(u){case"line":n.beginPath(),n.moveTo(k,y),n.lineTo(t,a),n.stroke();break;case"rectangle":n.strokeRect(k,y,s,c);break;case"circle":const o=(k+t)/2,d=(y+a)/2,g=Math.abs(s/2),l=Math.abs(c/2);n.beginPath(),n.ellipse(o,d,g,l,0,0,2*Math.PI),n.stroke();break;case"arrow":n.beginPath(),n.moveTo(k,y),n.lineTo(t,a),n.stroke();const x=Math.atan2(a-y,t-k);de(n,t,a,x,j*4);break}}else if(u!=="text"){switch(u){case"pencil":n.lineCap="round",n.lineJoin="round",n.lineTo(t,a),n.stroke();break;case"marker":n.lineCap="square",n.lineJoin="miter",n.lineTo(t,a),n.stroke();break;case"spray":for(let s=0;s<15;s++){const c=Math.random()*2*Math.PI,o=Math.random()*j,d=t+o*Math.cos(c),g=a+o*Math.sin(c);n.fillRect(d,g,1,1)}break}n.beginPath(),n.moveTo(t,a)}},le=e=>{if(v){S(null);return}if(!m.current)return;const t=m.current,{x:a,y:n}=_e(e);let s=a,c=n;if(["line","rectangle","circle","arrow"].includes(u)&&(isNaN(a)||isNaN(n))&&(s=k,c=y),T&&["line","rectangle","circle","arrow"].includes(u)){t.putImageData(T,0,0);const o=s-k,d=c-y;switch(u){case"line":t.beginPath(),t.moveTo(k,y),t.lineTo(s,c),t.stroke();break;case"rectangle":t.strokeRect(k,y,o,d);break;case"circle":const g=(k+s)/2,l=(y+c)/2,x=Math.abs(o/2),I=Math.abs(d/2);t.beginPath(),t.ellipse(g,l,x,I,0,0,2*Math.PI),t.stroke();break;case"arrow":t.beginPath(),t.moveTo(k,y),t.lineTo(s,c),t.stroke();const p=Math.atan2(c-y,s-k);de(t,s,c,p,j*4);break}X(null)}else u==="text"||t.closePath();H(!1),L()},Se=()=>{const e=w.current,t=m.current;if(e&&t&&window.confirm(h("widgets.drawing_pad.clear_confirm"))){if(te(null),t.clearRect(0,0,e.width,e.height),W(!1),Y(""),C.current){const a=C.current.getContext("2d");a&&a.clearRect(0,0,C.current.width,C.current.height)}V(!1),F({x:0,y:0}),S(null)}},Ie=e=>{b();const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=n=>{const s=new Image;s.onload=()=>{te(s),oe(),L()},s.src=n.target?.result},a.readAsDataURL(t)},Re=()=>{const e=w.current;if(e){const t=e.toDataURL("image/png"),a=document.createElement("a");a.href=t,a.download=h("widgets.drawing_pad.default_filename"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},ze=i.useCallback((e,t,a)=>{const n=m.current;!n||!e||(n.font=`${j*2}px Arial`,n.fillStyle=R,n.fillText(e,t,a))},[j,R]),he=()=>{q.trim()!==""&&(T?m.current?.putImageData(T,0,0):oe(),ze(q,ne,se),L()),W(!1),Y(""),X(null),H(!1)},Te=e=>{e.key==="Enter"&&he()},Pe=h(v?"widgets.drawing_pad.exit_pan":"widgets.drawing_pad.pan_mode");return r.jsxs("div",{className:"w-full h-full flex flex-col bg-gray-100 rounded-lg shadow-md overflow-hidden",children:[r.jsxs("div",{className:"p-2 bg-gray-200 flex items-center gap-2 border-b flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[r.jsx("button",{onClick:()=>{b(),ee("draw")},className:`p-2 rounded-md ${z==="draw"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.brush"),children:r.jsx(Ke,{size:20})}),r.jsx("button",{onClick:()=>{b(),ee("erase")},className:`p-2 rounded-md ${z==="erase"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.eraser"),children:r.jsx(qe,{size:20})})]}),z==="draw"&&r.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[r.jsx("button",{onClick:()=>{b(),N("pencil")},className:`p-2 rounded-md ${u==="pencil"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.pencil"),children:r.jsx(Qe,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("marker")},className:`p-2 rounded-md ${u==="marker"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.marker"),children:r.jsx(Fe,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("spray")},className:`p-2 rounded-md ${u==="spray"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.spray"),children:r.jsx(at,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("line")},className:`p-2 rounded-md ${u==="line"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.line"),children:r.jsx(He,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("rectangle")},className:`p-2 rounded-md ${u==="rectangle"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.rectangle"),children:r.jsx(st,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("circle")},className:`p-2 rounded-md ${u==="circle"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.circle"),children:r.jsx(De,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("arrow")},className:`p-2 rounded-md ${u==="arrow"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.arrow"),children:r.jsx(Le,{size:20})}),r.jsx("button",{onClick:()=>{b(),N("text")},className:`p-2 rounded-md ${u==="text"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.text"),children:r.jsx(it,{size:20})})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[z==="draw"&&r.jsx("input",{type:"color",value:R,onChange:e=>{b(),we(e.target.value)},className:"w-8 h-8 cursor-pointer rounded-md border border-gray-300",title:h("widgets.drawing_pad.select_color")}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"range",min:"1",max:"50",value:j,onChange:e=>{b(),me(Number(e.target.value))},className:"w-24 h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer",title:h("widgets.drawing_pad.brush_size")}),r.jsx("span",{className:"text-sm w-6 text-center text-gray-700",children:j})]})]}),r.jsxs("label",{htmlFor:"image-upload",className:"p-2 rounded-md hover:bg-gray-300 cursor-pointer",title:h("widgets.drawing_pad.upload_image"),children:[r.jsx(Xe,{size:20}),r.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:Ie,className:"hidden"})]}),r.jsx("button",{onClick:Re,className:"p-2 rounded-md hover:bg-green-300",title:h("widgets.drawing_pad.save_drawing"),children:r.jsx(et,{size:20})}),r.jsx("button",{onClick:Se,className:"p-2 rounded-md hover:bg-red-300",title:h("widgets.drawing_pad.clear_all"),children:r.jsx(Ye,{size:20})}),r.jsxs("div",{className:"ml-auto flex items-center gap-2 border-l pl-2",children:[r.jsx("button",{onClick:Me,className:`p-2 rounded-md ${v?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:Pe,children:r.jsx(Ve,{size:20})}),r.jsx("button",{onClick:Ce,className:"p-2 rounded-md hover:bg-blue-300",title:h("widgets.drawing_pad.center_view"),children:r.jsx(Ee,{size:20})})]})]}),r.jsxs("div",{className:"flex-grow w-full h-full relative bg-white",children:[r.jsx("canvas",{ref:w,onMouseDown:je,onMouseUp:e=>{if(v){S(null),L();return}u!=="text"&&le(e.nativeEvent)},onMouseLeave:e=>{v?S(null):Z&&u!=="text"&&le(e.nativeEvent)},onMouseMove:Ne,className:`w-full h-full block ${v?"cursor-grab":$?"cursor-grabbing":"cursor-crosshair"}`,style:{cursor:v?$?"grabbing":"grab":"crosshair"}}),!f&&A&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 text-lg pointer-events-none",children:h("widgets.drawing_pad.start_drawing")}),ae&&r.jsx("input",{type:"text",ref:re,value:q,onChange:e=>Y(e.target.value),onBlur:he,onKeyDown:Te,style:{position:"absolute",left:ne,top:se,fontSize:`${j*2}px`,color:R,fontFamily:"Arial",backgroundColor:"rgba(255, 255, 255, 0.8)",border:"1px solid #ccc",padding:"2px 5px",zIndex:100,minWidth:"50px",outline:"none",transform:"translate(-50%, -50%)"},className:"rounded-md shadow-sm"})]})]})};export{lt as DrawingPadWidget,gt as widgetConfig};
