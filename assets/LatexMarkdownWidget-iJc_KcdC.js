import{r as i,j as r}from"./vendor-react-CvxLrFbY.js";import{d as E}from"./vendor-marked-IrHqQMcX.js";import{k as f}from"./vendor-katex-KHco_4HN.js";import{t as L}from"./vendor-html-to-image-CCayPtYg.js";import{v as me}from"./index-BRUjA2Tl.js";import{u as M}from"./vendor-react-i18next-CV9wn5jO.js";import{ab as N,I as S,ac as R,s as F}from"./vendor-lucide-react-CYRm5Z9O.js";import"./vendor-clsx-DMbM62ou.js";import"./vendor-react-dom-ovwEKgq_.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-i18next-http-backend-BlWUewvL.js";import"./vendor-react-rnd-CJIym3is.js";import"./vendor-react-draggable-CHzIUO8G.js";import"./vendor-prop-types-Chjiymov.js";import"./vendor-re-resizable-Bd8fNV1d.js";import"./vendor-dnd-kit-core-C4pUYSBz.js";import"./vendor-dnd-kit-utilities-CZrAEsTl.js";import"./vendor-dnd-kit-accessibility-DKV5GxcV.js";import"./vendor-dnd-kit-sortable-BobZZm17.js";import"./vendor-fflate-PjZAcS34.js";import"./vendor-framer-motion-FfyGqyL8.js";import"./vendor-motion-dom-DtvSSoo0.js";import"./vendor-motion-utils-CjIqCkNq.js";import"./vendor-i18next-Bvlggjj8.js";import"./vendor-i18next-browser-languagedetector-OJKzRF51.js";import"./vendor-html-parse-stringify-C3VvPRF8.js";import"./vendor-void-elements-SshaXqDN.js";async function H(){let e="";for(const c of Array.from(document.styleSheets))try{if(c.cssRules)for(const l of Array.from(c.cssRules))e+=l.cssText}catch{}return e}function _(e,c,l){if(e.innerHTML="",c==="markdown"){const s=E.parse(l);e.innerHTML=s,e.innerHTML=e.innerHTML.replace(/\$\$([^$]+)\$\$/g,(p,o)=>f.renderToString(o.trim(),{throwOnError:!1,displayMode:!0})),e.innerHTML=e.innerHTML.replace(/\$([^$]+)\$/g,(p,o)=>f.renderToString(o.trim(),{throwOnError:!1,displayMode:!1}))}else f.render(l,e,{throwOnError:!0,displayMode:!0})}const de=()=>{const{t:e,i18n:c,ready:l}=M(),[s,p]=i.useState(`# Teorema de Pitágoras

En un triángulo rectángulo, el cuadrado de la hipotenusa es igual a la suma de los cuadrados de los catetos.

$$c = \\sqrt{a^2 + b^2}$$`);i.useEffect(()=>{const t=e("widgets.latex_markdown.sample_content");t!=="widgets.latex_markdown.sample_content"&&p(t)},[e,c.language]);const[o,g]=i.useState("markdown"),[h,k]=i.useState(""),u=i.useRef(null),x=i.useRef(null);i.useEffect(()=>{const t=x.current;if(t)return document.body.appendChild(t),()=>{t.parentNode&&t.parentNode.removeChild(t)}},[]);const w=t=>{k(t),setTimeout(()=>k(""),1800)},v=()=>{navigator.clipboard.writeText(s).then(()=>w(e("widgets.latex_markdown.source_copied"))).catch(()=>w(e("widgets.latex_markdown.copy_failed")))},b=async()=>{const t=u.current;if(!t)return;const a=await H();try{const n=await L(t,{backgroundColor:"#ffffff",fontEmbedCSS:a}),m=await(await fetch(n)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":m})]),w(e("widgets.latex_markdown.image_copied"))}catch{w(e("widgets.latex_markdown.copy_image_failed"))}},y=()=>{const t=o==="latex"?"tex":"md",a=o==="latex"?"text/x-latex":"text/markdown",n=new Blob([s],{type:`${a};charset=utf-8`}),m=URL.createObjectURL(n),d=document.createElement("a");d.href=m,d.download=`documento.${t}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m)},j=async()=>{const t=x.current;if(!t)return;_(t,o,s);try{await document.fonts?.ready}catch{}await new Promise(n=>requestAnimationFrame(()=>n()));const a=()=>{t.innerHTML="",window.removeEventListener("afterprint",a)};window.addEventListener("afterprint",a),window.print()};return i.useEffect(()=>{const t=u.current;if(t)try{_(t,o,s)}catch(a){if(o==="latex"&&a instanceof Error){const n=e("widgets.latex_markdown.latex_mode_title"),m=e("widgets.latex_markdown.latex_mode_description"),d=e("widgets.latex_markdown.how_to_proceed"),T=e("widgets.latex_markdown.isolated_formula"),$=e("widgets.latex_markdown.text_with_formulas"),C=e("widgets.latex_markdown.markdown");t.innerHTML=`
          <div class="friendly-error-pane">
            <h3>${n}</h3>
            <p>${m}</p>
            <h4>${d}</h4>
            <ul>
              <li>${T} <code>c = \\\\sqrt{a^2 + b^2}</code>.</li>
              <li>${$} <strong>${C}</strong>.</li>
            </ul>
          </div>
        `}else if(a instanceof Error){const n=e("widgets.latex_markdown.latex_syntax_error");t.innerHTML=`<div class="error-message">${n} ${a.message}</div>`}else{const n=e("widgets.latex_markdown.generic_error");t.innerHTML=`<div class="error-message">${n}</div>`}}},[s,o]),l?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"latex-markdown-widget",children:[r.jsxs("div",{className:"editor-pane",children:[r.jsxs("div",{className:"mode-selector",children:[r.jsx("button",{onClick:()=>g("markdown"),className:o==="markdown"?"active":"",children:"Markdown"}),r.jsx("button",{onClick:()=>g("latex"),className:o==="latex"?"active":"",children:"LaTeX"})]}),r.jsx("textarea",{value:s,onChange:t=>p(t.target.value),spellCheck:"false",className:"editor-textarea"})]}),r.jsxs("div",{className:"preview-container",children:[r.jsxs("div",{className:"preview-toolbar",children:[h&&r.jsx("span",{className:"feedback-message",children:h}),r.jsx("button",{title:e("widgets.latex_markdown.copy_source"),onClick:v,children:r.jsx(N,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.copy_image"),onClick:b,children:r.jsx(S,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.save_file"),onClick:y,children:r.jsx(R,{size:18})}),r.jsx("button",{title:e("widgets.latex_markdown.export_pdf"),onClick:j,children:r.jsx(F,{size:18})})]}),r.jsx("div",{className:"preview-pane prose",ref:u})]})]}),r.jsx("div",{id:"print-root",ref:x,className:"prose"})]}):r.jsx("div",{className:"flex items-center justify-center h-full",children:e("loading")})};export{de as LatexMarkdownWidget,me as widgetConfig};
