import{c as ee,u as te,r as n,j as t,a4 as A,a5 as se}from"./index-rAlYdcMp.js";import{a6 as fe}from"./index-rAlYdcMp.js";import{P as ie}from"./papaparse.min-CJXO8sEK.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],oe=ee("chevron-down",re),ne="https://docs.google.com/spreadsheets/d/e/2PACX-1vSj_hltRI4Q0QolINWJVcKxCMMjfpdiCkKzSdgp9d8RlGTdUU1UIKvaj-TBSkq0JQGneDhfUkSQuFzy/pub?output=csv",q="active-profile-name",z="active-profile-change",V="profiles-updated",ae="Escritorio Principal",ce=new Set(["google.com","www.google.com","g.co","docs.google.com","drive.google.com","sites.google.com","gemini.google.com"]),E=()=>{const s=window.localStorage.getItem(q);if(!s)return ae;try{const c=JSON.parse(s);return typeof c=="string"&&c.trim()?c:s}catch{return s}},F=s=>{const c=window.localStorage.getItem("desktop-profiles");if(!c)return[];try{return JSON.parse(c)?.[s]?.vceFavorites??[]}catch{return[]}},ve=()=>{const{t:s}=te(),[c,I]=n.useState([]),[b,G]=n.useState(""),[w,K]=n.useState(""),[p,B]=n.useState(""),[a,P]=n.useState(null),[Q,R]=n.useState(new Set),[u,T]=n.useState(!0),[g,U]=n.useState(!1),[J,x]=n.useState(!1),y=n.useRef(null),[m,M]=n.useState(()=>E()),[f,j]=n.useState(()=>F(E()));n.useEffect(()=>{let e=!0;return(async()=>{T(!0),U(!1);try{const r=await fetch(ne,{cache:"no-store"});if(!r.ok)throw new Error("CSV fetch failed");const l=await r.text(),o=ie.parse(l,{header:!0,skipEmptyLines:!0}),h="¿QUIERES ELIMINAR UN REGISTRO?\\nMarca la casilla y escribe más abajo la URL que tiene tu aplicación. En el resto de campos, escribe cualquier cosa y envía el formulario.\\nIMPORTANTE: Si solo quieres rectificar un registro, no marques esta casilla, haz lo que se  indica a continuación",_=d=>(d||"").split(",").map(L=>L.trim()).filter(Boolean),Z=(o.data||[]).map(d=>({title:(d["Título de la aplicación"]||"").trim(),author:(d["Tu nombre (Autor/a de la aplicación)"]||"").trim(),url:(d["Enlace (URL) a la aplicación"]||"").trim(),levels:_(d["Nivel o niveles educativos"]),areas:_(d["Área o áreas de conocimiento"]),description:(d["Descripción breve"]||"").trim(),deleteFlag:(d[h]||"").trim()})).filter(d=>d.title&&d.url&&!d.deleteFlag).map(({deleteFlag:d,...L})=>L);e&&I(Z)}catch{e&&U(!0)}finally{e&&T(!1)}})(),()=>{e=!1}},[]),n.useEffect(()=>{const e=l=>{const o=l.detail;M(o?.name||E())},i=l=>{l.key===q&&M(E())},r=()=>{j(F(m))};return window.addEventListener(z,e),window.addEventListener("storage",i),window.addEventListener(V,r),()=>{window.removeEventListener(z,e),window.removeEventListener("storage",i),window.removeEventListener(V,r)}},[m]),n.useEffect(()=>{j(F(m))},[m]);const W=n.useMemo(()=>{const e=new Set;return c.forEach(i=>i.levels.forEach(r=>e.add(r))),Array.from(e).sort((i,r)=>i.localeCompare(r))},[c]),$=n.useMemo(()=>{const e=new Set;return c.forEach(i=>i.areas.forEach(r=>e.add(r))),Array.from(e).sort((i,r)=>i.localeCompare(r))},[c]),S=n.useMemo(()=>{const e=b.trim().toLowerCase();return c.filter(i=>w&&!i.levels.includes(w)||p&&!i.areas.includes(p)?!1:e?i.title.toLowerCase().includes(e)||i.author.toLowerCase().includes(e)||i.description.toLowerCase().includes(e):!0)},[c,b,w,p]),H=e=>{try{const{hostname:i}=new URL(e);return ce.has(i)||i.endsWith(".google.com")}catch{return!1}},v=n.useMemo(()=>new Set(f),[f]),C=n.useMemo(()=>{const e=new Map(c.map(i=>[i.url,i]));return f.map(i=>e.get(i)).filter(i=>!!i)},[c,f]),X=n.useMemo(()=>S.filter(e=>!v.has(e.url)),[S,v]);n.useEffect(()=>{a&&!c.some(e=>e.url===a.url)&&P(null)},[a,c]),n.useEffect(()=>{x(!1)},[a?.url]);const k=e=>{j(i=>{const r=i.includes(e)?i.filter(l=>l!==e):[...i,e];return window.dispatchEvent(new CustomEvent("vce-favorites-update",{detail:{profileName:m,favorites:r}})),r})},O=(e,i)=>{j(r=>{const l=r.indexOf(e);if(l===-1)return r;const o=i==="up"?l-1:l+1;if(o<0||o>=r.length)return r;const h=[...r],[_]=h.splice(l,1);return h.splice(o,0,_),window.dispatchEvent(new CustomEvent("vce-favorites-update",{detail:{profileName:m,favorites:h}})),h})},D=e=>{R(i=>{const r=new Set(i);return r.has(e)?r.delete(e):r.add(e),r})},N=e=>{P(e),R(new Set)},Y=()=>{if(x(!1),!!y.current)try{const e=y.current.contentWindow?.location.href;(!e||e==="about:blank")&&x(!0)}catch{}};return t.jsxs("div",{className:"vce-widget",children:[t.jsxs("div",{className:"vce-header",children:[t.jsxs("div",{children:[t.jsx("div",{className:"vce-title",children:s("widgets.vce.title")}),t.jsx("div",{className:"vce-subtitle",children:s("widgets.vce.subtitle")})]}),t.jsxs("div",{className:"vce-actions",children:[t.jsx("button",{type:"button",className:"vce-open",onClick:()=>{a&&window.open(a.url,"_blank","noopener,noreferrer")},disabled:!a,children:s("widgets.vce.open_new_tab")}),a&&t.jsx("button",{type:"button",className:"vce-fav-toggle",onClick:()=>k(a.url),title:v.has(a.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),"aria-label":v.has(a.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),children:t.jsx(A,{size:16,fill:v.has(a.url)?"currentColor":"none"})})]})]}),t.jsxs("div",{className:"vce-filters",children:[t.jsx("input",{type:"text",className:"vce-search",value:b,onChange:e=>G(e.target.value),placeholder:s("widgets.vce.search_placeholder")}),t.jsxs("select",{className:"vce-select",value:w,onChange:e=>K(e.target.value),children:[t.jsx("option",{value:"",children:s("widgets.vce.filter_level_all")}),W.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{className:"vce-select",value:p,onChange:e=>B(e.target.value),children:[t.jsx("option",{value:"",children:s("widgets.vce.filter_area_all")}),$.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"vce-body",children:[t.jsxs("div",{className:"vce-list",children:[u&&t.jsx("div",{className:"vce-empty",children:s("widgets.vce.loading")}),g&&t.jsx("div",{className:"vce-empty",children:s("widgets.vce.load_error")}),!u&&!g&&S.length===0&&C.length===0&&t.jsx("div",{className:"vce-empty",children:s("widgets.vce.no_results")}),!u&&!g&&C.length>0&&t.jsx("div",{className:"vce-section",children:t.jsx("div",{className:"vce-section-title",children:s("widgets.vce.favorites_title")})}),!u&&!g&&C.map(e=>{const i=f.indexOf(e.url),r=i<=0,l=i===f.length-1;return t.jsx("div",{className:`vce-item vce-item-favorite${a?.url===e.url?" vce-item-active":""}`,onClick:()=>N(e),role:"button",tabIndex:0,onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),N(e))},children:t.jsxs("div",{className:"vce-item-header",children:[t.jsx("div",{className:"vce-item-title",children:e.title}),t.jsxs("div",{className:"vce-fav-actions",children:[t.jsx("button",{type:"button",className:"vce-fav-reorder",disabled:r,onClick:o=>{o.stopPropagation(),O(e.url,"up")},title:s("widgets.vce.move_up"),"aria-label":s("widgets.vce.move_up"),children:t.jsx(se,{size:14})}),t.jsx("button",{type:"button",className:"vce-fav-reorder",disabled:l,onClick:o=>{o.stopPropagation(),O(e.url,"down")},title:s("widgets.vce.move_down"),"aria-label":s("widgets.vce.move_down"),children:t.jsx(oe,{size:14})}),t.jsx("button",{type:"button",className:"vce-fav-toggle",onClick:o=>{o.stopPropagation(),k(e.url)},title:v.has(e.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),"aria-label":v.has(e.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),children:t.jsx(A,{size:16,fill:v.has(e.url)?"currentColor":"none"})})]})]})},e.url)}),!u&&!g&&X.map(e=>{const i=Q.has(e.url),r=!!e.description,l=r&&e.description.length>100&&!i;return t.jsxs("div",{className:`vce-item${a?.url===e.url?" vce-item-active":""}`,onClick:()=>N(e),role:"button",tabIndex:0,onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),N(e))},children:[t.jsxs("div",{className:"vce-item-header",children:[t.jsx("div",{className:"vce-item-title",children:e.title}),t.jsx("button",{type:"button",className:"vce-fav-toggle",onClick:o=>{o.stopPropagation(),k(e.url)},title:v.has(e.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),"aria-label":v.has(e.url)?s("widgets.vce.remove_favorite"):s("widgets.vce.add_favorite"),children:t.jsx(A,{size:16,fill:"none"})})]}),t.jsx("div",{className:"vce-item-author",children:e.author}),t.jsxs("div",{className:"vce-item-desc",children:[!r&&s("widgets.vce.no_description"),r&&l&&t.jsxs(t.Fragment,{children:[`${e.description.slice(0,100)} `,t.jsx("button",{type:"button",className:"vce-item-more",onClick:o=>{o.stopPropagation(),D(e.url)},children:s("widgets.vce.more")})]}),r&&!l&&t.jsxs(t.Fragment,{children:[e.description," ",e.description.length>100&&t.jsx("button",{type:"button",className:"vce-item-more",onClick:o=>{o.stopPropagation(),D(e.url)},children:s("widgets.vce.less")})]})]})]},e.url)})]}),t.jsx("div",{className:"vce-preview",children:a?J||H(a.url)?t.jsxs("div",{className:"vce-empty",children:[t.jsx("div",{children:s("widgets.vce.iframe_blocked")}),t.jsx("button",{type:"button",className:"vce-open vce-open-inline",onClick:()=>window.open(a.url,"_blank","noopener,noreferrer"),children:s("widgets.vce.open_new_tab")})]}):t.jsx("iframe",{ref:y,title:a.title,src:a.url,className:"vce-iframe",loading:"lazy",onLoad:Y,onError:()=>{x(!0)}},a.url):t.jsx("div",{className:"vce-empty",children:u?s("widgets.vce.loading"):t.jsxs("div",{className:"vce-intro",children:[t.jsx("div",{className:"vce-intro-title",children:s("widgets.vce.intro_title")}),t.jsxs("div",{className:"vce-intro-links",children:[t.jsx("a",{href:"https://t.me/vceduca",target:"_blank",rel:"noopener noreferrer",children:s("widgets.vce.intro_group_link")}),t.jsx("a",{href:"https://vibe-coding-educativo.github.io/",target:"_blank",rel:"noopener noreferrer",children:s("widgets.vce.intro_info_link")})]}),t.jsx("div",{className:"vce-intro-title",children:s("widgets.vce.intro_how_title")}),t.jsxs("ol",{className:"vce-intro-list",children:[t.jsx("li",{children:s("widgets.vce.intro_step1")}),t.jsx("li",{children:s("widgets.vce.intro_step2")}),t.jsx("li",{children:s("widgets.vce.intro_step3")}),t.jsx("li",{children:s("widgets.vce.intro_step4")}),t.jsx("li",{children:s("widgets.vce.intro_step5")})]})]})})})]})]})};export{ve as VceCommunityWidget,fe as widgetConfig};
