import{u as y,r as n,j as e,aI as N,aJ as b}from"./react-vendor-C9LHBUkp.js";import{J as K}from"./index-DIQ32RE2.js";import"./vendor-BnVc6iZf.js";import"./editor-vendor-Dlj3R3R2.js";import"./i18n-vendor-DdbEjq8F.js";const C={silence:{labelKey:"widgets.sound_meter.silence",emoji:"ðŸ¤«",className:"level-silence"},conversation:{labelKey:"widgets.sound_meter.conversation",emoji:"ðŸ—£ï¸",className:"level-conversation"},noise:{labelKey:"widgets.sound_meter.noise",emoji:"ðŸ’¥",className:"level-noise"}},L=()=>{const{t:s}=y(),[g,p]=n.useState("silence"),[u,o]=n.useState("prompt"),r=n.useRef(null),a=n.useRef(null),c=n.useRef(void 0),f=t=>t<15?"silence":t<45?"conversation":"noise",v=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(s("widgets.sound_meter.no_audio_support")),o("denied");return}const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});a.current=t;const d=window.AudioContext||window.webkitAudioContext;r.current=new d;const i=r.current.createAnalyser();r.current.createMediaStreamSource(t).connect(i),o("granted");const l=new Uint8Array(i.frequencyBinCount),m=()=>{i.getByteFrequencyData(l);const w=l.reduce((_,h)=>_+h,0)/l.length;p(f(w)),c.current=requestAnimationFrame(m)};m()}catch(t){console.error(s("widgets.sound_meter.microphone_error"),t),o("denied")}},x=()=>{c.current&&cancelAnimationFrame(c.current),a.current&&a.current.getTracks().forEach(t=>t.stop()),r.current&&r.current.state!=="closed"&&r.current.close()};n.useEffect(()=>()=>x(),[]);const j=()=>{if(u==="granted"){const{labelKey:t,emoji:d,className:i}=C[g];return e.jsxs("div",{className:`level-card ${i}`,children:[e.jsx("span",{className:"emoji",children:d}),e.jsx("span",{className:"label",children:s(t)})]})}return e.jsx("div",{className:"permission-screen",children:u==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:48,className:"text-red-500"}),e.jsx("p",{children:s("widgets.sound_meter.access_denied")}),e.jsx("small",{children:s("widgets.sound_meter.enable_browser_settings")})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:48}),e.jsx("p",{children:s("widgets.sound_meter.permission_needed")}),e.jsx("button",{onClick:v,className:"permission-button",children:s("widgets.sound_meter.activate_meter")})]})})};return e.jsx("div",{className:"sound-meter-widget",children:j()})};export{L as SoundMeterWidget,K as widgetConfig};
